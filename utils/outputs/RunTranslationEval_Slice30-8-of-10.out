============================================================================================== 
Warning! Mixing Conda and module environments may lead to corruption of the
user environment. 
We do not recommend users mixing those two environments unless absolutely
necessary. Note that 
SURF does not provide any support for Conda environment.
For more information, please refer to our software policy page:
https://servicedesk.surf.nl/wiki/display/WIKI/Software+policy+Snellius#SoftwarepolicySnellius-UseofAnacondaandMinicondaenvironmentsonSnellius 

Remember that many packages have already been installed on the system and can
be loaded using 
the 'module load <package__name>' command. If you are uncertain if a package is
already available 
on the system, please use 'module avail' or 'module spider' to search for it.
============================================================================================== 
GPU available? True
Processing file: /home/scur1769/ALMA-Matters/datasets/human-translations/ALMA_test_cs-en.json
2024-10-02 22:39:36,157 - INFO - Loading sliced haoranxu/ALMA-7B model from /home/scur1769/ALMA-Matters/models with sparsity 0.3
2024-10-02 22:39:36,158 - INFO - Loading haoranxu/ALMA-7B config from Hugging Face
Using LlamaAdapter for ALMA-7B
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:02<00:05,  2.91s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:05<00:02,  2.89s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:07<00:00,  2.54s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:07<00:00,  2.64s/it]
2024-10-02 22:39:45,270 - INFO - Loading model done
2024-10-02 22:39:45,270 - INFO - Replacing layers
2024-10-02 22:39:46,157 - INFO - Replacing layers done
2024-10-02 22:39:46,158 - INFO - Fusing layernorm modules
2024-10-02 22:39:49,130 - INFO - Fusing layernorm modules done
2024-10-02 22:39:49,349 - INFO - Loading sliced model weights from /home/scur1769/ALMA-Matters/models
/gpfs/home4/scur1769/ALMA-Matters/compression/pruning/TransformerCompression/src/slicegpt/hf_utils.py:183: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  torch.load(str(pathlib.Path(sliced_model_path) / my_sliced_model_name), map_location="cpu")
2024-10-02 22:39:55,047 - INFO - Model dtype: torch.float16
  0%|          | 0/181 [00:00<?, ?it/s]  1%|          | 1/181 [00:03<10:23,  3.46s/it]  1%|          | 2/181 [00:05<07:38,  2.56s/it]  2%|▏         | 3/181 [00:07<07:16,  2.45s/it]  2%|▏         | 4/181 [00:11<09:15,  3.14s/it]  3%|▎         | 5/181 [00:15<09:39,  3.29s/it]  3%|▎         | 6/181 [00:19<10:46,  3.69s/it]  4%|▍         | 7/181 [00:48<34:11, 11.79s/it]  4%|▍         | 8/181 [00:51<26:26,  9.17s/it]  5%|▍         | 9/181 [01:21<44:48, 15.63s/it]  6%|▌         | 10/181 [01:25<34:01, 11.94s/it]  6%|▌         | 11/181 [01:30<27:51,  9.83s/it]  7%|▋         | 12/181 [01:35<23:13,  8.24s/it]  7%|▋         | 13/181 [01:37<17:53,  6.39s/it]  8%|▊         | 14/181 [01:40<14:43,  5.29s/it]  8%|▊         | 15/181 [01:43<12:59,  4.70s/it]  9%|▉         | 16/181 [01:46<12:01,  4.37s/it]  9%|▉         | 17/181 [02:15<32:04, 11.74s/it] 10%|▉         | 18/181 [02:19<25:06,  9.24s/it] 10%|█         | 19/181 [02:49<41:54, 15.52s/it] 11%|█         | 20/181 [03:17<51:29, 19.19s/it] 12%|█▏        | 21/181 [03:19<37:56, 14.23s/it] 12%|█▏        | 22/181 [03:22<28:51, 10.89s/it] 13%|█▎        | 23/181 [03:27<23:38,  8.98s/it] 13%|█▎        | 24/181 [03:29<18:17,  6.99s/it] 14%|█▍        | 25/181 [03:33<15:18,  5.89s/it] 14%|█▍        | 26/181 [03:36<12:54,  5.00s/it] 15%|█▍        | 27/181 [03:39<11:24,  4.45s/it] 15%|█▌        | 28/181 [03:44<11:39,  4.57s/it] 16%|█▌        | 29/181 [03:47<10:45,  4.25s/it] 17%|█▋        | 30/181 [03:51<10:22,  4.12s/it] 17%|█▋        | 31/181 [03:54<09:24,  3.76s/it] 18%|█▊        | 32/181 [04:23<28:30, 11.48s/it] 18%|█▊        | 33/181 [04:26<21:32,  8.74s/it] 19%|█▉        | 34/181 [04:28<16:53,  6.90s/it] 19%|█▉        | 35/181 [04:31<13:47,  5.67s/it] 20%|█▉        | 36/181 [04:34<11:52,  4.92s/it] 20%|██        | 37/181 [04:37<10:17,  4.29s/it] 21%|██        | 38/181 [04:42<10:48,  4.54s/it] 22%|██▏       | 39/181 [04:46<10:07,  4.28s/it] 22%|██▏       | 40/181 [04:49<09:15,  3.94s/it] 23%|██▎       | 41/181 [05:19<27:16, 11.69s/it] 23%|██▎       | 42/181 [05:48<39:06, 16.88s/it] 24%|██▍       | 43/181 [06:22<50:59, 22.17s/it] 24%|██▍       | 44/181 [06:27<38:33, 16.88s/it] 25%|██▍       | 45/181 [06:59<48:49, 21.54s/it] 25%|██▌       | 46/181 [07:03<36:11, 16.09s/it] 26%|██▌       | 47/181 [07:06<27:36, 12.36s/it] 27%|██▋       | 48/181 [07:10<21:51,  9.86s/it] 27%|██▋       | 49/181 [07:14<17:28,  7.94s/it] 28%|██▊       | 50/181 [07:16<13:55,  6.38s/it] 28%|██▊       | 51/181 [07:19<11:24,  5.27s/it] 29%|██▊       | 52/181 [07:22<10:06,  4.70s/it] 29%|██▉       | 53/181 [07:49<24:11, 11.34s/it] 30%|██▉       | 54/181 [07:52<18:47,  8.88s/it] 30%|███       | 55/181 [07:55<14:37,  6.97s/it] 31%|███       | 56/181 [07:58<12:08,  5.83s/it] 31%|███▏      | 57/181 [08:28<27:09, 13.14s/it] 32%|███▏      | 58/181 [08:34<22:15, 10.85s/it] 33%|███▎      | 59/181 [09:08<36:31, 17.96s/it] 33%|███▎      | 60/181 [09:12<27:41, 13.74s/it] 34%|███▎      | 61/181 [09:15<20:52, 10.44s/it] 34%|███▍      | 62/181 [09:19<17:00,  8.57s/it] 35%|███▍      | 63/181 [09:23<14:02,  7.14s/it] 35%|███▌      | 64/181 [09:56<28:47, 14.76s/it] 36%|███▌      | 65/181 [10:20<34:01, 17.60s/it] 36%|███▋      | 66/181 [10:24<26:01, 13.58s/it] 37%|███▋      | 67/181 [10:30<21:32, 11.34s/it] 38%|███▊      | 68/181 [10:33<16:51,  8.95s/it] 38%|███▊      | 69/181 [10:38<14:02,  7.52s/it] 39%|███▊      | 70/181 [10:40<11:16,  6.09s/it] 39%|███▉      | 71/181 [10:45<10:09,  5.54s/it] 40%|███▉      | 72/181 [10:48<08:37,  4.75s/it] 40%|████      | 73/181 [10:50<07:06,  3.95s/it] 41%|████      | 74/181 [11:16<19:14, 10.79s/it] 41%|████▏     | 75/181 [11:20<15:27,  8.75s/it] 42%|████▏     | 76/181 [11:23<12:17,  7.02s/it] 43%|████▎     | 77/181 [11:27<10:37,  6.13s/it] 43%|████▎     | 78/181 [11:31<09:04,  5.29s/it] 44%|████▎     | 79/181 [11:33<07:36,  4.48s/it] 44%|████▍     | 80/181 [11:36<06:26,  3.82s/it] 45%|████▍     | 81/181 [11:39<05:57,  3.57s/it] 45%|████▌     | 82/181 [11:42<05:53,  3.57s/it] 46%|████▌     | 83/181 [11:45<05:31,  3.38s/it] 46%|████▋     | 84/181 [11:47<04:50,  2.99s/it] 47%|████▋     | 85/181 [11:53<05:59,  3.74s/it] 48%|████▊     | 86/181 [11:56<05:37,  3.55s/it] 48%|████▊     | 87/181 [11:59<05:29,  3.51s/it] 49%|████▊     | 88/181 [12:02<05:02,  3.25s/it] 49%|████▉     | 89/181 [12:04<04:26,  2.89s/it] 50%|████▉     | 90/181 [12:06<04:11,  2.76s/it] 50%|█████     | 91/181 [12:13<05:39,  3.77s/it] 51%|█████     | 92/181 [12:15<04:59,  3.37s/it] 51%|█████▏    | 93/181 [12:17<04:34,  3.12s/it] 52%|█████▏    | 94/181 [12:20<04:06,  2.84s/it] 52%|█████▏    | 95/181 [12:22<03:55,  2.74s/it] 53%|█████▎    | 96/181 [12:26<04:20,  3.06s/it] 54%|█████▎    | 97/181 [12:36<07:09,  5.12s/it] 54%|█████▍    | 98/181 [12:39<06:07,  4.43s/it] 55%|█████▍    | 99/181 [12:41<05:17,  3.87s/it] 55%|█████▌    | 100/181 [12:45<05:20,  3.95s/it] 56%|█████▌    | 101/181 [12:49<04:56,  3.70s/it] 56%|█████▋    | 102/181 [12:51<04:20,  3.30s/it] 57%|█████▋    | 103/181 [12:55<04:31,  3.48s/it] 57%|█████▋    | 104/181 [12:57<03:58,  3.09s/it] 58%|█████▊    | 105/181 [13:06<06:18,  4.98s/it] 59%|█████▊    | 106/181 [13:11<06:07,  4.90s/it] 59%|█████▉    | 107/181 [13:23<08:36,  6.98s/it] 60%|█████▉    | 108/181 [13:27<07:35,  6.24s/it] 60%|██████    | 109/181 [13:31<06:36,  5.51s/it] 61%|██████    | 110/181 [14:02<15:37, 13.21s/it] 61%|██████▏   | 111/181 [14:05<11:41, 10.03s/it] 62%|██████▏   | 112/181 [14:38<19:19, 16.81s/it] 62%|██████▏   | 113/181 [14:40<14:17, 12.61s/it] 63%|██████▎   | 114/181 [14:45<11:30, 10.31s/it] 64%|██████▎   | 115/181 [14:48<08:38,  7.86s/it] 64%|██████▍   | 116/181 [14:51<07:01,  6.48s/it] 65%|██████▍   | 117/181 [14:53<05:39,  5.31s/it] 65%|██████▌   | 118/181 [14:57<04:55,  4.69s/it] 66%|██████▌   | 119/181 [15:00<04:30,  4.36s/it] 66%|██████▋   | 120/181 [15:03<04:00,  3.94s/it] 67%|██████▋   | 121/181 [15:34<12:04, 12.07s/it] 67%|██████▋   | 122/181 [15:36<08:54,  9.06s/it] 68%|██████▊   | 123/181 [16:07<14:58, 15.49s/it] 69%|██████▊   | 124/181 [16:13<12:03, 12.69s/it] 69%|██████▉   | 125/181 [16:16<09:14,  9.89s/it] 70%|██████▉   | 126/181 [16:19<07:07,  7.77s/it] 70%|███████   | 127/181 [16:26<06:50,  7.61s/it] 71%|███████   | 128/181 [16:58<13:07, 14.86s/it] 71%|███████▏  | 129/181 [17:01<09:44, 11.23s/it] 72%|███████▏  | 130/181 [17:03<07:15,  8.54s/it] 72%|███████▏  | 131/181 [17:05<05:34,  6.69s/it] 73%|███████▎  | 132/181 [17:08<04:25,  5.42s/it] 73%|███████▎  | 133/181 [17:11<03:44,  4.68s/it] 74%|███████▍  | 134/181 [17:13<03:06,  3.97s/it] 75%|███████▍  | 135/181 [17:18<03:06,  4.06s/it] 75%|███████▌  | 136/181 [17:21<02:51,  3.81s/it] 76%|███████▌  | 137/181 [17:51<08:32, 11.64s/it] 76%|███████▌  | 138/181 [17:53<06:25,  8.96s/it] 77%|███████▋  | 139/181 [17:56<04:59,  7.13s/it] 77%|███████▋  | 140/181 [17:58<03:51,  5.65s/it] 78%|███████▊  | 141/181 [18:30<08:58, 13.46s/it] 78%|███████▊  | 142/181 [18:32<06:33, 10.08s/it] 79%|███████▉  | 143/181 [18:35<05:00,  7.92s/it] 80%|███████▉  | 144/181 [18:38<03:57,  6.43s/it] 80%|████████  | 145/181 [18:41<03:15,  5.44s/it] 81%|████████  | 146/181 [18:45<02:52,  4.92s/it] 81%|████████  | 147/181 [18:47<02:18,  4.08s/it] 82%|████████▏ | 148/181 [18:52<02:18,  4.21s/it] 82%|████████▏ | 149/181 [19:25<06:54, 12.95s/it] 83%|████████▎ | 150/181 [19:32<05:44, 11.12s/it] 83%|████████▎ | 151/181 [19:36<04:34,  9.16s/it] 84%|████████▍ | 152/181 [19:39<03:31,  7.31s/it] 85%|████████▍ | 153/181 [19:42<02:46,  5.93s/it] 85%|████████▌ | 154/181 [19:46<02:27,  5.48s/it] 86%|████████▌ | 155/181 [19:49<01:56,  4.48s/it] 86%|████████▌ | 156/181 [19:52<01:44,  4.18s/it] 87%|████████▋ | 157/181 [19:55<01:29,  3.73s/it] 87%|████████▋ | 158/181 [20:27<04:44, 12.37s/it] 88%|████████▊ | 159/181 [20:30<03:28,  9.48s/it] 88%|████████▊ | 160/181 [20:34<02:42,  7.74s/it] 89%|████████▉ | 161/181 [20:37<02:06,  6.34s/it] 90%|████████▉ | 162/181 [20:39<01:37,  5.15s/it] 90%|█████████ | 163/181 [20:41<01:15,  4.21s/it] 91%|█████████ | 164/181 [21:14<03:38, 12.85s/it] 91%|█████████ | 165/181 [21:19<02:46, 10.38s/it] 92%|█████████▏| 166/181 [21:22<02:01,  8.08s/it] 92%|█████████▏| 167/181 [21:26<01:36,  6.91s/it] 93%|█████████▎| 168/181 [21:58<03:08, 14.52s/it] 93%|█████████▎| 169/181 [22:07<02:35, 12.96s/it] 94%|█████████▍| 170/181 [22:13<01:58, 10.74s/it] 94%|█████████▍| 171/181 [22:15<01:21,  8.19s/it] 95%|█████████▌| 172/181 [22:18<01:00,  6.73s/it] 96%|█████████▌| 173/181 [22:20<00:41,  5.23s/it] 96%|█████████▌| 174/181 [22:22<00:29,  4.26s/it] 97%|█████████▋| 175/181 [22:24<00:21,  3.63s/it] 97%|█████████▋| 176/181 [22:28<00:17,  3.58s/it] 98%|█████████▊| 177/181 [22:31<00:14,  3.54s/it] 98%|█████████▊| 178/181 [22:34<00:09,  3.28s/it] 99%|█████████▉| 179/181 [22:37<00:06,  3.13s/it] 99%|█████████▉| 180/181 [22:40<00:03,  3.08s/it]100%|██████████| 181/181 [22:43<00:00,  3.08s/it]182it [22:46,  3.21s/it]                         182it [22:46,  7.51s/it]
2024-10-02 23:02:41,777 - INFO - Completed evaluation for cs-en. Results saved to /home/scur1769/ALMA-Matters/evaluation/results/30-slice/result_cs-en.txt
Processing file: /home/scur1769/ALMA-Matters/datasets/human-translations/ALMA_test_de-en.json
2024-10-02 23:02:46,280 - INFO - Loading sliced haoranxu/ALMA-7B model from /home/scur1769/ALMA-Matters/models with sparsity 0.3
2024-10-02 23:02:46,280 - INFO - Loading haoranxu/ALMA-7B config from Hugging Face
Using LlamaAdapter for ALMA-7B
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:01<00:02,  1.16s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:02<00:01,  1.13s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:03<00:00,  1.01it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:03<00:00,  1.03s/it]
2024-10-02 23:02:50,498 - INFO - Loading model done
2024-10-02 23:02:50,498 - INFO - Replacing layers
2024-10-02 23:02:51,380 - INFO - Replacing layers done
2024-10-02 23:02:51,380 - INFO - Fusing layernorm modules
2024-10-02 23:02:54,363 - INFO - Fusing layernorm modules done
2024-10-02 23:02:54,597 - INFO - Loading sliced model weights from /home/scur1769/ALMA-Matters/models
/gpfs/home4/scur1769/ALMA-Matters/compression/pruning/TransformerCompression/src/slicegpt/hf_utils.py:183: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  torch.load(str(pathlib.Path(sliced_model_path) / my_sliced_model_name), map_location="cpu")
2024-10-02 23:03:00,389 - INFO - Model dtype: torch.float16
  0%|          | 0/248 [00:00<?, ?it/s]  0%|          | 1/248 [00:02<10:18,  2.50s/it]  1%|          | 2/248 [00:04<08:17,  2.02s/it]  1%|          | 3/248 [00:06<09:34,  2.35s/it]  2%|▏         | 4/248 [00:10<10:54,  2.68s/it]  2%|▏         | 5/248 [00:11<09:35,  2.37s/it]  2%|▏         | 6/248 [00:14<10:23,  2.58s/it]  3%|▎         | 7/248 [00:19<12:32,  3.12s/it]  3%|▎         | 8/248 [00:32<25:11,  6.30s/it]  4%|▎         | 9/248 [00:36<21:54,  5.50s/it]  4%|▍         | 10/248 [00:38<18:25,  4.65s/it]  4%|▍         | 11/248 [00:41<16:11,  4.10s/it]  5%|▍         | 12/248 [00:44<14:23,  3.66s/it]  5%|▌         | 13/248 [01:11<41:54, 10.70s/it]  6%|▌         | 14/248 [01:12<31:06,  7.98s/it]  6%|▌         | 15/248 [01:14<23:39,  6.09s/it]  6%|▋         | 16/248 [01:40<46:59, 12.15s/it]  7%|▋         | 17/248 [01:43<35:48,  9.30s/it]  7%|▋         | 18/248 [01:46<28:35,  7.46s/it]  8%|▊         | 19/248 [01:50<24:15,  6.35s/it]  8%|▊         | 20/248 [02:18<49:27, 13.01s/it]  8%|▊         | 21/248 [02:21<37:02,  9.79s/it]  9%|▉         | 22/248 [02:24<29:20,  7.79s/it]  9%|▉         | 23/248 [02:27<24:00,  6.40s/it] 10%|▉         | 24/248 [02:55<48:11, 12.91s/it] 10%|█         | 25/248 [02:57<35:27,  9.54s/it] 10%|█         | 26/248 [02:58<26:25,  7.14s/it] 11%|█         | 27/248 [03:01<21:00,  5.70s/it] 11%|█▏        | 28/248 [03:03<16:47,  4.58s/it] 12%|█▏        | 29/248 [03:06<14:53,  4.08s/it] 12%|█▏        | 30/248 [03:07<11:56,  3.29s/it] 12%|█▎        | 31/248 [03:11<12:31,  3.46s/it] 13%|█▎        | 32/248 [03:14<12:03,  3.35s/it] 13%|█▎        | 33/248 [03:17<11:36,  3.24s/it] 14%|█▎        | 34/248 [03:19<10:08,  2.84s/it] 14%|█▍        | 35/248 [03:21<09:40,  2.73s/it] 15%|█▍        | 36/248 [03:24<09:42,  2.75s/it] 15%|█▍        | 37/248 [03:53<36:50, 10.48s/it] 15%|█▌        | 38/248 [03:56<29:29,  8.42s/it] 16%|█▌        | 39/248 [04:00<24:50,  7.13s/it] 16%|█▌        | 40/248 [04:03<19:34,  5.65s/it] 17%|█▋        | 41/248 [04:05<16:19,  4.73s/it] 17%|█▋        | 42/248 [04:09<15:14,  4.44s/it] 17%|█▋        | 43/248 [04:11<12:54,  3.78s/it] 18%|█▊        | 44/248 [04:14<11:50,  3.48s/it] 18%|█▊        | 45/248 [04:16<10:34,  3.12s/it] 19%|█▊        | 46/248 [04:28<19:02,  5.65s/it] 19%|█▉        | 47/248 [04:34<19:16,  5.76s/it] 19%|█▉        | 48/248 [04:36<16:00,  4.80s/it] 20%|█▉        | 49/248 [04:39<13:22,  4.03s/it] 20%|██        | 50/248 [04:42<12:56,  3.92s/it] 21%|██        | 51/248 [04:44<11:03,  3.37s/it] 21%|██        | 52/248 [04:46<09:42,  2.97s/it] 21%|██▏       | 53/248 [05:13<32:51, 10.11s/it] 22%|██▏       | 54/248 [05:16<25:39,  7.93s/it] 22%|██▏       | 55/248 [05:19<20:48,  6.47s/it] 23%|██▎       | 56/248 [05:54<48:27, 15.14s/it] 23%|██▎       | 57/248 [06:26<1:04:06, 20.14s/it] 23%|██▎       | 58/248 [06:31<49:19, 15.57s/it]   24%|██▍       | 59/248 [06:36<38:47, 12.31s/it] 24%|██▍       | 60/248 [06:39<30:19,  9.68s/it] 25%|██▍       | 61/248 [06:46<27:28,  8.82s/it] 25%|██▌       | 62/248 [06:48<20:30,  6.62s/it] 25%|██▌       | 63/248 [06:49<15:43,  5.10s/it] 26%|██▌       | 64/248 [06:51<12:57,  4.23s/it] 26%|██▌       | 65/248 [06:55<11:55,  3.91s/it] 27%|██▋       | 66/248 [06:57<10:11,  3.36s/it] 27%|██▋       | 67/248 [07:00<10:18,  3.42s/it] 27%|██▋       | 68/248 [07:03<09:24,  3.14s/it] 28%|██▊       | 69/248 [07:06<09:31,  3.19s/it] 28%|██▊       | 70/248 [07:10<10:05,  3.40s/it] 29%|██▊       | 71/248 [07:11<08:24,  2.85s/it] 29%|██▉       | 72/248 [07:13<06:51,  2.34s/it] 29%|██▉       | 73/248 [07:39<27:29,  9.42s/it] 30%|██▉       | 74/248 [08:03<40:12, 13.87s/it] 30%|███       | 75/248 [08:07<31:13, 10.83s/it] 31%|███       | 76/248 [08:08<23:02,  8.04s/it] 31%|███       | 77/248 [08:35<38:48, 13.62s/it] 31%|███▏      | 78/248 [08:39<30:39, 10.82s/it] 32%|███▏      | 79/248 [08:42<23:56,  8.50s/it] 32%|███▏      | 80/248 [08:46<20:04,  7.17s/it] 33%|███▎      | 81/248 [08:49<16:04,  5.77s/it] 33%|███▎      | 82/248 [08:51<13:05,  4.73s/it] 33%|███▎      | 83/248 [08:53<10:50,  3.94s/it] 34%|███▍      | 84/248 [09:17<27:24, 10.03s/it] 34%|███▍      | 85/248 [09:19<20:52,  7.68s/it] 35%|███▍      | 86/248 [09:45<34:47, 12.88s/it] 35%|███▌      | 87/248 [09:48<26:41,  9.95s/it] 35%|███▌      | 88/248 [09:51<21:28,  8.05s/it] 36%|███▌      | 89/248 [09:54<16:54,  6.38s/it] 36%|███▋      | 90/248 [09:56<13:54,  5.28s/it] 37%|███▋      | 91/248 [09:59<11:34,  4.42s/it] 37%|███▋      | 92/248 [10:28<30:53, 11.88s/it] 38%|███▊      | 93/248 [10:30<23:05,  8.94s/it] 38%|███▊      | 94/248 [10:34<18:49,  7.34s/it] 38%|███▊      | 95/248 [10:36<15:09,  5.94s/it] 39%|███▊      | 96/248 [10:40<13:01,  5.14s/it] 39%|███▉      | 97/248 [11:08<30:04, 11.95s/it] 40%|███▉      | 98/248 [11:09<22:13,  8.89s/it] 40%|███▉      | 99/248 [11:12<17:26,  7.02s/it] 40%|████      | 100/248 [11:38<31:41, 12.85s/it] 41%|████      | 101/248 [11:42<24:26,  9.98s/it] 41%|████      | 102/248 [12:07<35:12, 14.47s/it] 42%|████▏     | 103/248 [12:09<26:04, 10.79s/it] 42%|████▏     | 104/248 [12:11<19:21,  8.07s/it] 42%|████▏     | 105/248 [12:42<35:55, 15.07s/it] 43%|████▎     | 106/248 [12:46<27:47, 11.75s/it] 43%|████▎     | 107/248 [12:50<21:48,  9.28s/it] 44%|████▎     | 108/248 [12:54<18:03,  7.74s/it] 44%|████▍     | 109/248 [12:57<14:41,  6.34s/it] 44%|████▍     | 110/248 [12:59<12:04,  5.25s/it] 45%|████▍     | 111/248 [13:04<11:26,  5.01s/it] 45%|████▌     | 112/248 [13:07<09:45,  4.31s/it] 46%|████▌     | 113/248 [13:10<09:09,  4.07s/it] 46%|████▌     | 114/248 [13:12<07:58,  3.57s/it] 46%|████▋     | 115/248 [13:14<06:28,  2.92s/it] 47%|████▋     | 116/248 [13:42<22:54, 10.41s/it] 47%|████▋     | 117/248 [13:45<18:06,  8.30s/it] 48%|████▊     | 118/248 [13:47<13:44,  6.34s/it] 48%|████▊     | 119/248 [13:49<11:08,  5.18s/it] 48%|████▊     | 120/248 [13:52<09:12,  4.31s/it] 49%|████▉     | 121/248 [13:54<07:33,  3.57s/it] 49%|████▉     | 122/248 [14:18<20:28,  9.75s/it] 50%|████▉     | 123/248 [14:20<15:27,  7.42s/it] 50%|█████     | 124/248 [14:22<11:58,  5.80s/it] 50%|█████     | 125/248 [14:24<09:50,  4.80s/it] 51%|█████     | 126/248 [14:27<08:15,  4.06s/it] 51%|█████     | 127/248 [14:28<06:52,  3.41s/it] 52%|█████▏    | 128/248 [14:30<05:48,  2.90s/it] 52%|█████▏    | 129/248 [14:33<05:50,  2.95s/it] 52%|█████▏    | 130/248 [14:36<05:33,  2.82s/it] 53%|█████▎    | 131/248 [14:39<05:53,  3.02s/it] 53%|█████▎    | 132/248 [14:43<06:08,  3.18s/it] 54%|█████▎    | 133/248 [14:45<05:43,  2.99s/it] 54%|█████▍    | 134/248 [14:48<05:20,  2.81s/it] 54%|█████▍    | 135/248 [14:53<06:27,  3.43s/it] 55%|█████▍    | 136/248 [14:57<07:05,  3.80s/it] 55%|█████▌    | 137/248 [15:24<19:43, 10.66s/it] 56%|█████▌    | 138/248 [15:25<14:17,  7.80s/it] 56%|█████▌    | 139/248 [15:27<11:14,  6.19s/it] 56%|█████▋    | 140/248 [15:31<09:32,  5.30s/it] 57%|█████▋    | 141/248 [15:33<07:38,  4.28s/it] 57%|█████▋    | 142/248 [15:36<07:02,  3.98s/it] 58%|█████▊    | 143/248 [15:39<06:29,  3.71s/it] 58%|█████▊    | 144/248 [15:42<06:17,  3.63s/it] 58%|█████▊    | 145/248 [16:10<18:34, 10.82s/it] 59%|█████▉    | 146/248 [16:14<14:52,  8.75s/it] 59%|█████▉    | 147/248 [16:16<11:25,  6.78s/it] 60%|█████▉    | 148/248 [16:45<22:14, 13.35s/it] 60%|██████    | 149/248 [16:46<16:06,  9.76s/it] 60%|██████    | 150/248 [16:48<12:08,  7.43s/it] 61%|██████    | 151/248 [16:51<09:35,  5.93s/it] 61%|██████▏   | 152/248 [16:53<07:57,  4.97s/it] 62%|██████▏   | 153/248 [16:55<06:18,  3.99s/it] 62%|██████▏   | 154/248 [17:20<16:05, 10.27s/it] 62%|██████▎   | 155/248 [17:22<12:20,  7.96s/it] 63%|██████▎   | 156/248 [17:25<09:53,  6.46s/it] 63%|██████▎   | 157/248 [17:27<07:32,  4.97s/it] 64%|██████▎   | 158/248 [17:51<16:14, 10.83s/it] 64%|██████▍   | 159/248 [17:54<12:24,  8.36s/it] 65%|██████▍   | 160/248 [17:56<09:33,  6.52s/it] 65%|██████▍   | 161/248 [18:25<19:18, 13.31s/it] 65%|██████▌   | 162/248 [18:52<24:54, 17.38s/it] 66%|██████▌   | 163/248 [18:55<18:21, 12.95s/it] 66%|██████▌   | 164/248 [18:57<13:40,  9.77s/it] 67%|██████▋   | 165/248 [18:59<10:17,  7.44s/it] 67%|██████▋   | 166/248 [19:28<18:54, 13.84s/it] 67%|██████▋   | 167/248 [19:31<14:05, 10.44s/it] 68%|██████▊   | 168/248 [19:59<21:18, 15.98s/it] 68%|██████▊   | 169/248 [20:05<16:55, 12.86s/it] 69%|██████▊   | 170/248 [20:08<12:54,  9.93s/it] 69%|██████▉   | 171/248 [20:13<10:46,  8.39s/it] 69%|██████▉   | 172/248 [20:16<08:34,  6.76s/it] 70%|██████▉   | 173/248 [20:48<17:59, 14.39s/it] 70%|███████   | 174/248 [20:55<14:54, 12.09s/it] 71%|███████   | 175/248 [21:00<12:14, 10.05s/it] 71%|███████   | 176/248 [21:26<17:53, 14.91s/it] 71%|███████▏  | 177/248 [21:30<13:37, 11.51s/it] 72%|███████▏  | 178/248 [21:33<10:31,  9.02s/it] 72%|███████▏  | 179/248 [21:37<08:29,  7.39s/it] 73%|███████▎  | 180/248 [21:39<06:42,  5.91s/it] 73%|███████▎  | 181/248 [21:42<05:38,  5.06s/it] 73%|███████▎  | 182/248 [22:17<15:26, 14.03s/it] 74%|███████▍  | 183/248 [22:49<20:50, 19.25s/it] 74%|███████▍  | 184/248 [22:53<15:45, 14.77s/it] 75%|███████▍  | 185/248 [22:55<11:34, 11.03s/it] 75%|███████▌  | 186/248 [22:57<08:38,  8.36s/it] 75%|███████▌  | 187/248 [22:58<06:17,  6.19s/it] 76%|███████▌  | 188/248 [23:01<04:58,  4.98s/it] 76%|███████▌  | 189/248 [23:03<04:00,  4.08s/it] 77%|███████▋  | 190/248 [23:06<03:40,  3.80s/it] 77%|███████▋  | 191/248 [23:13<04:42,  4.96s/it] 77%|███████▋  | 192/248 [23:45<12:07, 12.99s/it] 78%|███████▊  | 193/248 [23:50<09:34, 10.44s/it] 78%|███████▊  | 194/248 [24:23<15:29, 17.22s/it] 79%|███████▊  | 195/248 [24:26<11:32, 13.07s/it] 79%|███████▉  | 196/248 [24:29<08:45, 10.11s/it] 79%|███████▉  | 197/248 [24:33<06:57,  8.19s/it] 80%|███████▉  | 198/248 [24:40<06:29,  7.78s/it] 80%|████████  | 199/248 [24:44<05:29,  6.72s/it] 81%|████████  | 200/248 [24:48<04:41,  5.87s/it] 81%|████████  | 201/248 [25:15<09:34, 12.22s/it] 81%|████████▏ | 202/248 [25:17<06:57,  9.08s/it] 82%|████████▏ | 203/248 [25:19<05:09,  6.88s/it] 82%|████████▏ | 204/248 [25:21<04:03,  5.54s/it] 83%|████████▎ | 205/248 [25:24<03:27,  4.83s/it] 83%|████████▎ | 206/248 [25:28<03:05,  4.42s/it] 83%|████████▎ | 207/248 [25:29<02:27,  3.61s/it] 84%|████████▍ | 208/248 [25:32<02:17,  3.43s/it] 84%|████████▍ | 209/248 [25:36<02:14,  3.44s/it] 85%|████████▍ | 210/248 [25:38<01:55,  3.05s/it] 85%|████████▌ | 211/248 [25:44<02:31,  4.11s/it] 85%|████████▌ | 212/248 [26:19<07:52, 13.12s/it] 86%|████████▌ | 213/248 [26:21<05:43,  9.81s/it] 86%|████████▋ | 214/248 [26:50<08:48, 15.54s/it] 87%|████████▋ | 215/248 [26:52<06:18, 11.47s/it] 87%|████████▋ | 216/248 [26:54<04:43,  8.87s/it] 88%|████████▊ | 217/248 [27:21<07:19, 14.17s/it] 88%|████████▊ | 218/248 [27:23<05:18, 10.60s/it] 88%|████████▊ | 219/248 [27:26<04:01,  8.33s/it] 89%|████████▊ | 220/248 [27:29<03:05,  6.62s/it] 89%|████████▉ | 221/248 [27:31<02:20,  5.22s/it] 90%|████████▉ | 222/248 [27:36<02:16,  5.24s/it] 90%|████████▉ | 223/248 [27:38<01:48,  4.36s/it] 90%|█████████ | 224/248 [27:41<01:30,  3.78s/it] 91%|█████████ | 225/248 [27:45<01:27,  3.82s/it] 91%|█████████ | 226/248 [27:50<01:31,  4.17s/it] 92%|█████████▏| 227/248 [27:54<01:27,  4.18s/it] 92%|█████████▏| 228/248 [27:57<01:14,  3.73s/it] 92%|█████████▏| 229/248 [27:59<01:04,  3.40s/it] 93%|█████████▎| 230/248 [28:04<01:06,  3.69s/it] 93%|█████████▎| 231/248 [28:07<01:03,  3.71s/it] 94%|█████████▎| 232/248 [28:11<00:58,  3.65s/it] 94%|█████████▍| 233/248 [28:40<02:50, 11.34s/it] 94%|█████████▍| 234/248 [28:42<01:59,  8.55s/it] 95%|█████████▍| 235/248 [28:48<01:40,  7.75s/it] 95%|█████████▌| 236/248 [28:50<01:12,  6.03s/it] 96%|█████████▌| 237/248 [28:52<00:53,  4.88s/it] 96%|█████████▌| 238/248 [28:56<00:45,  4.52s/it] 96%|█████████▋| 239/248 [29:01<00:43,  4.79s/it] 97%|█████████▋| 240/248 [29:05<00:34,  4.35s/it] 97%|█████████▋| 241/248 [29:07<00:26,  3.83s/it] 98%|█████████▊| 242/248 [29:10<00:20,  3.48s/it] 98%|█████████▊| 243/248 [29:13<00:16,  3.30s/it] 98%|█████████▊| 244/248 [29:39<00:40, 10.09s/it] 99%|█████████▉| 245/248 [29:42<00:24,  8.05s/it] 99%|█████████▉| 246/248 [29:46<00:13,  6.70s/it]100%|█████████▉| 247/248 [29:48<00:05,  5.52s/it]100%|██████████| 248/248 [29:51<00:00,  4.71s/it]249it [30:19, 11.66s/it]                         250it [30:20,  8.54s/it]250it [30:20,  7.28s/it]
2024-10-02 23:33:21,261 - INFO - Completed evaluation for de-en. Results saved to /home/scur1769/ALMA-Matters/evaluation/results/30-slice/result_de-en.txt
Processing file: /home/scur1769/ALMA-Matters/datasets/human-translations/ALMA_test_en-cs.json
2024-10-02 23:33:25,247 - INFO - Loading sliced haoranxu/ALMA-7B model from /home/scur1769/ALMA-Matters/models with sparsity 0.3
2024-10-02 23:33:25,247 - INFO - Loading haoranxu/ALMA-7B config from Hugging Face
Using LlamaAdapter for ALMA-7B
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:01<00:02,  1.16s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:02<00:01,  1.14s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:03<00:00,  1.01it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:03<00:00,  1.03s/it]
2024-10-02 23:33:29,655 - INFO - Loading model done
2024-10-02 23:33:29,655 - INFO - Replacing layers
2024-10-02 23:33:30,529 - INFO - Replacing layers done
2024-10-02 23:33:30,529 - INFO - Fusing layernorm modules
2024-10-02 23:33:33,459 - INFO - Fusing layernorm modules done
2024-10-02 23:33:33,688 - INFO - Loading sliced model weights from /home/scur1769/ALMA-Matters/models
/gpfs/home4/scur1769/ALMA-Matters/compression/pruning/TransformerCompression/src/slicegpt/hf_utils.py:183: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  torch.load(str(pathlib.Path(sliced_model_path) / my_sliced_model_name), map_location="cpu")
2024-10-02 23:33:39,367 - INFO - Model dtype: torch.float16
  0%|          | 0/255 [00:00<?, ?it/s]  0%|          | 1/255 [00:03<16:44,  3.95s/it]  1%|          | 2/255 [00:07<14:37,  3.47s/it]  1%|          | 3/255 [00:09<12:03,  2.87s/it]  2%|▏         | 4/255 [00:11<11:13,  2.68s/it]  2%|▏         | 5/255 [00:13<10:39,  2.56s/it]  2%|▏         | 6/255 [00:17<11:34,  2.79s/it]  3%|▎         | 7/255 [00:20<12:33,  3.04s/it]  3%|▎         | 8/255 [00:23<12:41,  3.08s/it]  4%|▎         | 9/255 [00:27<12:40,  3.09s/it]  4%|▍         | 10/255 [00:31<14:16,  3.50s/it]  4%|▍         | 11/255 [00:33<12:15,  3.01s/it]  5%|▍         | 12/255 [00:35<11:00,  2.72s/it]  5%|▌         | 13/255 [00:38<10:54,  2.70s/it]  5%|▌         | 14/255 [00:41<11:49,  2.95s/it]  6%|▌         | 15/255 [00:44<11:08,  2.79s/it]  6%|▋         | 16/255 [00:47<11:58,  3.01s/it]  7%|▋         | 17/255 [00:50<11:38,  2.93s/it]  7%|▋         | 18/255 [00:53<11:33,  2.93s/it]  7%|▋         | 19/255 [00:57<13:18,  3.38s/it]  8%|▊         | 20/255 [00:59<11:24,  2.91s/it]  8%|▊         | 21/255 [01:26<39:15, 10.07s/it]  9%|▊         | 22/255 [01:50<55:06, 14.19s/it]  9%|▉         | 23/255 [02:13<1:05:24, 16.91s/it]  9%|▉         | 24/255 [02:14<47:33, 12.35s/it]   10%|▉         | 25/255 [02:17<36:13,  9.45s/it] 10%|█         | 26/255 [02:20<28:06,  7.36s/it] 11%|█         | 27/255 [02:22<22:09,  5.83s/it] 11%|█         | 28/255 [02:26<20:21,  5.38s/it] 11%|█▏        | 29/255 [02:28<15:51,  4.21s/it] 12%|█▏        | 30/255 [02:34<17:32,  4.68s/it] 12%|█▏        | 31/255 [02:38<16:51,  4.52s/it] 13%|█▎        | 32/255 [03:04<41:20, 11.12s/it] 13%|█▎        | 33/255 [03:06<31:13,  8.44s/it] 13%|█▎        | 34/255 [03:10<25:48,  7.01s/it] 14%|█▎        | 35/255 [03:13<20:46,  5.67s/it] 14%|█▍        | 36/255 [03:18<20:01,  5.49s/it] 15%|█▍        | 37/255 [03:44<42:21, 11.66s/it] 15%|█▍        | 38/255 [03:46<32:00,  8.85s/it] 15%|█▌        | 39/255 [03:51<27:13,  7.56s/it] 16%|█▌        | 40/255 [03:55<23:20,  6.52s/it] 16%|█▌        | 41/255 [03:58<19:33,  5.48s/it] 16%|█▋        | 42/255 [04:00<15:47,  4.45s/it] 17%|█▋        | 43/255 [04:24<36:44, 10.40s/it] 17%|█▋        | 44/255 [04:26<27:31,  7.83s/it] 18%|█▊        | 45/255 [04:29<22:18,  6.37s/it] 18%|█▊        | 46/255 [04:31<18:18,  5.26s/it] 18%|█▊        | 47/255 [04:33<14:38,  4.22s/it] 19%|█▉        | 48/255 [04:35<11:52,  3.44s/it] 19%|█▉        | 49/255 [04:36<09:49,  2.86s/it] 20%|█▉        | 50/255 [05:00<31:23,  9.19s/it] 20%|██        | 51/255 [05:03<24:24,  7.18s/it] 20%|██        | 52/255 [05:05<19:40,  5.82s/it] 21%|██        | 53/255 [05:09<17:23,  5.17s/it] 21%|██        | 54/255 [05:16<19:27,  5.81s/it] 22%|██▏       | 55/255 [05:19<16:35,  4.98s/it] 22%|██▏       | 56/255 [05:23<15:23,  4.64s/it] 22%|██▏       | 57/255 [05:26<13:33,  4.11s/it] 23%|██▎       | 58/255 [05:30<13:30,  4.11s/it] 23%|██▎       | 59/255 [05:34<12:35,  3.85s/it] 24%|██▎       | 60/255 [05:36<11:28,  3.53s/it] 24%|██▍       | 61/255 [05:39<10:58,  3.39s/it] 24%|██▍       | 62/255 [05:42<10:29,  3.26s/it] 25%|██▍       | 63/255 [05:45<09:35,  3.00s/it] 25%|██▌       | 64/255 [05:48<10:13,  3.21s/it] 25%|██▌       | 65/255 [05:50<08:39,  2.73s/it] 26%|██▌       | 66/255 [05:52<07:49,  2.48s/it] 26%|██▋       | 67/255 [06:15<27:27,  8.77s/it] 27%|██▋       | 68/255 [06:19<22:27,  7.21s/it] 27%|██▋       | 69/255 [06:22<18:44,  6.05s/it] 27%|██▋       | 70/255 [06:25<15:34,  5.05s/it] 28%|██▊       | 71/255 [06:27<12:56,  4.22s/it] 28%|██▊       | 72/255 [06:53<32:25, 10.63s/it] 29%|██▊       | 73/255 [06:55<24:03,  7.93s/it] 29%|██▉       | 74/255 [06:56<18:30,  6.13s/it] 29%|██▉       | 75/255 [07:00<15:49,  5.28s/it] 30%|██▉       | 76/255 [07:24<32:49, 11.00s/it] 30%|███       | 77/255 [07:26<24:39,  8.31s/it] 31%|███       | 78/255 [07:52<40:03, 13.58s/it] 31%|███       | 79/255 [07:54<29:46, 10.15s/it] 31%|███▏      | 80/255 [07:56<22:06,  7.58s/it] 32%|███▏      | 81/255 [07:58<17:45,  6.12s/it] 32%|███▏      | 82/255 [08:22<32:41, 11.34s/it] 33%|███▎      | 83/255 [08:24<24:47,  8.65s/it] 33%|███▎      | 84/255 [08:27<19:07,  6.71s/it] 33%|███▎      | 85/255 [08:30<15:56,  5.63s/it] 34%|███▎      | 86/255 [08:32<13:17,  4.72s/it] 34%|███▍      | 87/255 [08:35<11:11,  4.00s/it] 35%|███▍      | 88/255 [08:36<09:03,  3.25s/it] 35%|███▍      | 89/255 [08:38<07:56,  2.87s/it] 35%|███▌      | 90/255 [08:40<06:43,  2.44s/it] 36%|███▌      | 91/255 [08:43<07:15,  2.65s/it] 36%|███▌      | 92/255 [08:45<07:12,  2.65s/it] 36%|███▋      | 93/255 [08:51<09:21,  3.46s/it] 37%|███▋      | 94/255 [08:54<09:26,  3.52s/it] 37%|███▋      | 95/255 [08:57<08:38,  3.24s/it] 38%|███▊      | 96/255 [08:59<07:47,  2.94s/it] 38%|███▊      | 97/255 [09:01<06:51,  2.61s/it] 38%|███▊      | 98/255 [09:02<05:48,  2.22s/it] 39%|███▉      | 99/255 [09:03<04:46,  1.83s/it] 39%|███▉      | 100/255 [09:05<04:56,  1.91s/it] 40%|███▉      | 101/255 [09:08<05:11,  2.02s/it] 40%|████      | 102/255 [09:35<24:11,  9.49s/it] 40%|████      | 103/255 [09:36<17:57,  7.09s/it] 41%|████      | 104/255 [09:38<14:10,  5.63s/it] 41%|████      | 105/255 [09:40<11:27,  4.58s/it] 42%|████▏     | 106/255 [09:43<09:40,  3.90s/it] 42%|████▏     | 107/255 [09:45<08:08,  3.30s/it] 42%|████▏     | 108/255 [09:47<07:45,  3.17s/it] 43%|████▎     | 109/255 [09:51<07:43,  3.17s/it] 43%|████▎     | 110/255 [09:52<06:42,  2.78s/it] 44%|████▎     | 111/255 [10:18<23:08,  9.64s/it] 44%|████▍     | 112/255 [10:22<18:41,  7.84s/it] 44%|████▍     | 113/255 [10:26<15:44,  6.65s/it] 45%|████▍     | 114/255 [10:29<13:38,  5.81s/it] 45%|████▌     | 115/255 [10:31<10:53,  4.66s/it] 45%|████▌     | 116/255 [10:34<09:16,  4.00s/it] 46%|████▌     | 117/255 [10:59<23:54, 10.39s/it] 46%|████▋     | 118/255 [11:26<35:02, 15.34s/it] 47%|████▋     | 119/255 [11:29<26:17, 11.60s/it] 47%|████▋     | 120/255 [11:31<19:49,  8.81s/it] 47%|████▋     | 121/255 [11:33<14:49,  6.64s/it] 48%|████▊     | 122/255 [11:59<27:51, 12.57s/it] 48%|████▊     | 123/255 [12:01<20:31,  9.33s/it] 49%|████▊     | 124/255 [12:04<16:11,  7.42s/it] 49%|████▉     | 125/255 [12:08<13:46,  6.36s/it] 49%|████▉     | 126/255 [12:11<11:31,  5.36s/it] 50%|████▉     | 127/255 [12:13<09:28,  4.44s/it] 50%|█████     | 128/255 [12:16<08:13,  3.89s/it] 51%|█████     | 129/255 [12:18<06:51,  3.26s/it] 51%|█████     | 130/255 [12:22<07:31,  3.61s/it] 51%|█████▏    | 131/255 [12:26<07:23,  3.57s/it] 52%|█████▏    | 132/255 [12:33<09:42,  4.73s/it] 52%|█████▏    | 133/255 [12:38<09:39,  4.75s/it] 53%|█████▎    | 134/255 [12:44<10:14,  5.08s/it] 53%|█████▎    | 135/255 [12:45<07:50,  3.92s/it] 53%|█████▎    | 136/255 [12:46<06:12,  3.13s/it] 54%|█████▎    | 137/255 [12:51<06:58,  3.55s/it] 54%|█████▍    | 138/255 [12:53<06:00,  3.08s/it] 55%|█████▍    | 139/255 [12:55<05:41,  2.94s/it] 55%|█████▍    | 140/255 [12:57<05:07,  2.67s/it] 55%|█████▌    | 141/255 [12:59<04:19,  2.28s/it] 56%|█████▌    | 142/255 [13:01<04:28,  2.37s/it] 56%|█████▌    | 143/255 [13:04<04:31,  2.42s/it] 56%|█████▋    | 144/255 [13:27<16:06,  8.71s/it] 57%|█████▋    | 145/255 [13:29<12:09,  6.63s/it] 57%|█████▋    | 146/255 [13:30<09:17,  5.11s/it] 58%|█████▊    | 147/255 [13:32<07:09,  3.98s/it] 58%|█████▊    | 148/255 [13:33<05:46,  3.24s/it] 58%|█████▊    | 149/255 [13:35<04:46,  2.70s/it] 59%|█████▉    | 150/255 [13:37<04:15,  2.43s/it] 59%|█████▉    | 151/255 [13:38<03:36,  2.08s/it] 60%|█████▉    | 152/255 [13:40<03:26,  2.00s/it] 60%|██████    | 153/255 [13:41<03:08,  1.85s/it] 60%|██████    | 154/255 [13:46<04:22,  2.60s/it] 61%|██████    | 155/255 [13:48<04:28,  2.69s/it] 61%|██████    | 156/255 [13:52<04:46,  2.89s/it] 62%|██████▏   | 157/255 [13:54<04:33,  2.79s/it] 62%|██████▏   | 158/255 [13:57<04:30,  2.79s/it] 62%|██████▏   | 159/255 [14:01<04:50,  3.02s/it] 63%|██████▎   | 160/255 [14:04<04:59,  3.15s/it] 63%|██████▎   | 161/255 [14:07<04:44,  3.02s/it] 64%|██████▎   | 162/255 [14:11<05:21,  3.46s/it] 64%|██████▍   | 163/255 [14:13<04:39,  3.03s/it] 64%|██████▍   | 164/255 [14:16<04:36,  3.04s/it] 65%|██████▍   | 165/255 [14:40<13:37,  9.08s/it] 65%|██████▌   | 166/255 [15:03<19:58, 13.47s/it] 65%|██████▌   | 167/255 [15:28<24:28, 16.68s/it] 66%|██████▌   | 168/255 [15:32<18:51, 13.01s/it] 66%|██████▋   | 169/255 [15:35<14:34, 10.16s/it] 67%|██████▋   | 170/255 [15:38<11:13,  7.92s/it] 67%|██████▋   | 171/255 [15:41<09:01,  6.45s/it] 67%|██████▋   | 172/255 [16:05<16:11, 11.70s/it] 68%|██████▊   | 173/255 [16:30<21:13, 15.53s/it] 68%|██████▊   | 174/255 [16:35<16:48, 12.45s/it] 69%|██████▊   | 175/255 [16:40<13:41, 10.26s/it] 69%|██████▉   | 176/255 [16:43<10:40,  8.11s/it] 69%|██████▉   | 177/255 [16:45<08:12,  6.32s/it] 70%|██████▉   | 178/255 [16:47<06:24,  4.99s/it] 70%|███████   | 179/255 [16:49<05:09,  4.08s/it] 71%|███████   | 180/255 [16:51<04:06,  3.29s/it] 71%|███████   | 181/255 [16:52<03:32,  2.88s/it] 71%|███████▏  | 182/255 [16:56<03:40,  3.03s/it] 72%|███████▏  | 183/255 [16:58<03:29,  2.90s/it] 72%|███████▏  | 184/255 [17:02<03:44,  3.16s/it] 73%|███████▎  | 185/255 [17:05<03:42,  3.17s/it] 73%|███████▎  | 186/255 [17:07<03:05,  2.69s/it] 73%|███████▎  | 187/255 [17:11<03:26,  3.04s/it] 74%|███████▎  | 188/255 [17:15<03:55,  3.52s/it] 74%|███████▍  | 189/255 [17:19<04:02,  3.67s/it] 75%|███████▍  | 190/255 [17:21<03:22,  3.11s/it] 75%|███████▍  | 191/255 [17:23<02:54,  2.73s/it] 75%|███████▌  | 192/255 [17:26<02:45,  2.63s/it] 76%|███████▌  | 193/255 [17:28<02:45,  2.67s/it] 76%|███████▌  | 194/255 [17:32<02:54,  2.86s/it] 76%|███████▋  | 195/255 [17:36<03:10,  3.18s/it] 77%|███████▋  | 196/255 [17:39<03:13,  3.27s/it] 77%|███████▋  | 197/255 [17:44<03:31,  3.65s/it] 78%|███████▊  | 198/255 [17:47<03:28,  3.66s/it] 78%|███████▊  | 199/255 [17:51<03:20,  3.59s/it] 78%|███████▊  | 200/255 [17:53<02:58,  3.24s/it] 79%|███████▉  | 201/255 [17:55<02:40,  2.98s/it] 79%|███████▉  | 202/255 [17:59<02:43,  3.08s/it] 80%|███████▉  | 203/255 [18:01<02:34,  2.97s/it] 80%|████████  | 204/255 [18:04<02:29,  2.93s/it] 80%|████████  | 205/255 [18:07<02:27,  2.95s/it] 81%|████████  | 206/255 [18:34<08:06,  9.93s/it] 81%|████████  | 207/255 [18:36<06:09,  7.70s/it] 82%|████████▏ | 208/255 [18:37<04:33,  5.82s/it] 82%|████████▏ | 209/255 [18:40<03:40,  4.80s/it] 82%|████████▏ | 210/255 [18:42<03:02,  4.05s/it] 83%|████████▎ | 211/255 [18:46<02:49,  3.86s/it] 83%|████████▎ | 212/255 [18:50<02:49,  3.95s/it] 84%|████████▎ | 213/255 [18:54<02:55,  4.18s/it] 84%|████████▍ | 214/255 [18:57<02:36,  3.82s/it] 84%|████████▍ | 215/255 [19:00<02:14,  3.37s/it] 85%|████████▍ | 216/255 [19:02<02:03,  3.17s/it] 85%|████████▌ | 217/255 [19:04<01:47,  2.83s/it] 85%|████████▌ | 218/255 [19:07<01:44,  2.81s/it] 86%|████████▌ | 219/255 [19:09<01:26,  2.40s/it] 86%|████████▋ | 220/255 [19:10<01:15,  2.16s/it] 87%|████████▋ | 221/255 [19:13<01:15,  2.21s/it] 87%|████████▋ | 222/255 [19:14<01:07,  2.04s/it] 87%|████████▋ | 223/255 [19:16<01:02,  1.96s/it] 88%|████████▊ | 224/255 [19:23<01:43,  3.32s/it] 88%|████████▊ | 225/255 [19:27<01:50,  3.67s/it] 89%|████████▊ | 226/255 [19:31<01:45,  3.64s/it] 89%|████████▉ | 227/255 [19:33<01:28,  3.17s/it] 89%|████████▉ | 228/255 [19:35<01:18,  2.91s/it] 90%|████████▉ | 229/255 [19:37<01:12,  2.78s/it] 90%|█████████ | 230/255 [19:40<01:03,  2.56s/it] 91%|█████████ | 231/255 [19:44<01:14,  3.09s/it] 91%|█████████ | 232/255 [19:47<01:09,  3.01s/it] 91%|█████████▏| 233/255 [20:15<03:54, 10.64s/it] 92%|█████████▏| 234/255 [20:40<05:10, 14.81s/it] 92%|█████████▏| 235/255 [20:41<03:36, 10.81s/it] 93%|█████████▎| 236/255 [20:43<02:36,  8.24s/it] 93%|█████████▎| 237/255 [20:47<02:02,  6.80s/it] 93%|█████████▎| 238/255 [20:50<01:35,  5.61s/it] 94%|█████████▎| 239/255 [20:52<01:15,  4.69s/it] 94%|█████████▍| 240/255 [20:54<00:59,  3.96s/it] 95%|█████████▍| 241/255 [20:56<00:46,  3.35s/it] 95%|█████████▍| 242/255 [20:59<00:42,  3.24s/it] 95%|█████████▌| 243/255 [21:02<00:35,  2.99s/it] 96%|█████████▌| 244/255 [21:04<00:32,  2.91s/it] 96%|█████████▌| 245/255 [21:06<00:25,  2.52s/it] 96%|█████████▋| 246/255 [21:11<00:28,  3.21s/it] 97%|█████████▋| 247/255 [21:12<00:21,  2.68s/it] 97%|█████████▋| 248/255 [21:15<00:19,  2.72s/it] 98%|█████████▊| 249/255 [21:18<00:15,  2.67s/it] 98%|█████████▊| 250/255 [21:20<00:13,  2.68s/it] 98%|█████████▊| 251/255 [21:23<00:10,  2.63s/it] 99%|█████████▉| 252/255 [21:25<00:07,  2.34s/it] 99%|█████████▉| 253/255 [21:34<00:08,  4.37s/it]100%|█████████▉| 254/255 [21:39<00:04,  4.60s/it]100%|██████████| 255/255 [21:42<00:00,  4.06s/it]100%|██████████| 255/255 [21:42<00:00,  5.11s/it]
2024-10-02 23:55:21,515 - INFO - Completed evaluation for en-cs. Results saved to /home/scur1769/ALMA-Matters/evaluation/results/30-slice/result_en-cs.txt
Processing file: /home/scur1769/ALMA-Matters/datasets/human-translations/ALMA_test_en-de.json
2024-10-02 23:55:25,428 - INFO - Loading sliced haoranxu/ALMA-7B model from /home/scur1769/ALMA-Matters/models with sparsity 0.3
2024-10-02 23:55:25,428 - INFO - Loading haoranxu/ALMA-7B config from Hugging Face
Using LlamaAdapter for ALMA-7B
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:01<00:02,  1.18s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:02<00:01,  1.16s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:03<00:00,  1.00s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:03<00:00,  1.05s/it]
2024-10-02 23:55:29,686 - INFO - Loading model done
2024-10-02 23:55:29,686 - INFO - Replacing layers
2024-10-02 23:55:30,559 - INFO - Replacing layers done
2024-10-02 23:55:30,559 - INFO - Fusing layernorm modules
2024-10-02 23:55:33,505 - INFO - Fusing layernorm modules done
2024-10-02 23:55:33,727 - INFO - Loading sliced model weights from /home/scur1769/ALMA-Matters/models
/gpfs/home4/scur1769/ALMA-Matters/compression/pruning/TransformerCompression/src/slicegpt/hf_utils.py:183: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  torch.load(str(pathlib.Path(sliced_model_path) / my_sliced_model_name), map_location="cpu")
2024-10-02 23:55:39,356 - INFO - Model dtype: torch.float16
  0%|          | 0/255 [00:00<?, ?it/s]  0%|          | 1/255 [00:04<16:59,  4.01s/it]  1%|          | 2/255 [00:08<17:55,  4.25s/it]  1%|          | 3/255 [00:36<1:02:52, 14.97s/it]  2%|▏         | 4/255 [00:39<43:14, 10.34s/it]    2%|▏         | 5/255 [00:41<31:01,  7.45s/it]  2%|▏         | 6/255 [00:46<26:36,  6.41s/it]  3%|▎         | 7/255 [00:50<23:11,  5.61s/it]  3%|▎         | 8/255 [00:57<25:28,  6.19s/it]  4%|▎         | 9/255 [01:02<24:01,  5.86s/it]  4%|▍         | 10/255 [01:06<21:10,  5.19s/it]  4%|▍         | 11/255 [01:07<16:41,  4.11s/it]  5%|▍         | 12/255 [01:10<14:14,  3.52s/it]  5%|▌         | 13/255 [01:13<13:53,  3.45s/it]  5%|▌         | 14/255 [01:16<13:00,  3.24s/it]  6%|▌         | 15/255 [01:18<12:20,  3.09s/it]  6%|▋         | 16/255 [01:20<10:56,  2.74s/it]  7%|▋         | 17/255 [01:22<09:51,  2.49s/it]  7%|▋         | 18/255 [01:25<09:38,  2.44s/it]  7%|▋         | 19/255 [01:28<10:50,  2.76s/it]  8%|▊         | 20/255 [01:32<11:37,  2.97s/it]  8%|▊         | 21/255 [01:35<12:29,  3.20s/it]  9%|▊         | 22/255 [01:38<12:10,  3.14s/it]  9%|▉         | 23/255 [01:41<11:35,  3.00s/it]  9%|▉         | 24/255 [01:45<12:31,  3.25s/it] 10%|▉         | 25/255 [02:11<38:29, 10.04s/it] 10%|█         | 26/255 [02:13<30:01,  7.87s/it] 11%|█         | 27/255 [02:17<25:22,  6.68s/it] 11%|█         | 28/255 [02:44<48:01, 12.69s/it] 11%|█▏        | 29/255 [02:47<36:58,  9.82s/it] 12%|█▏        | 30/255 [02:49<27:25,  7.31s/it] 12%|█▏        | 31/255 [02:51<22:07,  5.93s/it] 13%|█▎        | 32/255 [02:55<19:16,  5.19s/it] 13%|█▎        | 33/255 [02:58<16:39,  4.50s/it] 13%|█▎        | 34/255 [03:00<14:33,  3.95s/it] 14%|█▎        | 35/255 [03:03<12:46,  3.48s/it] 14%|█▍        | 36/255 [03:04<10:30,  2.88s/it] 15%|█▍        | 37/255 [03:06<09:16,  2.55s/it] 15%|█▍        | 38/255 [03:08<08:38,  2.39s/it] 15%|█▌        | 39/255 [03:10<07:36,  2.11s/it] 16%|█▌        | 40/255 [03:34<31:43,  8.85s/it] 16%|█▌        | 41/255 [03:36<23:49,  6.68s/it] 16%|█▋        | 42/255 [03:37<18:05,  5.10s/it] 17%|█▋        | 43/255 [03:39<15:00,  4.25s/it] 17%|█▋        | 44/255 [03:49<20:39,  5.87s/it] 18%|█▊        | 45/255 [03:52<17:46,  5.08s/it] 18%|█▊        | 46/255 [03:55<14:43,  4.23s/it] 18%|█▊        | 47/255 [03:58<13:45,  3.97s/it] 19%|█▉        | 48/255 [04:00<12:13,  3.54s/it] 19%|█▉        | 49/255 [04:30<38:30, 11.21s/it] 20%|█▉        | 50/255 [04:54<52:12, 15.28s/it] 20%|██        | 51/255 [04:57<39:10, 11.52s/it] 20%|██        | 52/255 [05:02<31:54,  9.43s/it] 21%|██        | 53/255 [05:05<25:44,  7.65s/it] 21%|██        | 54/255 [05:08<21:11,  6.33s/it] 22%|██▏       | 55/255 [05:11<17:33,  5.27s/it] 22%|██▏       | 56/255 [05:14<15:25,  4.65s/it] 22%|██▏       | 57/255 [05:43<38:51, 11.78s/it] 23%|██▎       | 58/255 [05:46<30:25,  9.27s/it] 23%|██▎       | 59/255 [05:48<23:04,  7.06s/it] 24%|██▎       | 60/255 [05:51<18:28,  5.68s/it] 24%|██▍       | 61/255 [05:55<16:48,  5.20s/it] 24%|██▍       | 62/255 [05:58<14:40,  4.56s/it] 25%|██▍       | 63/255 [06:01<13:18,  4.16s/it] 25%|██▌       | 64/255 [06:03<10:51,  3.41s/it] 25%|██▌       | 65/255 [06:27<30:31,  9.64s/it] 26%|██▌       | 66/255 [06:53<45:47, 14.54s/it] 26%|██▋       | 67/255 [06:55<33:52, 10.81s/it] 27%|██▋       | 68/255 [06:58<26:07,  8.38s/it] 27%|██▋       | 69/255 [06:59<19:51,  6.41s/it] 27%|██▋       | 70/255 [07:02<15:55,  5.17s/it] 28%|██▊       | 71/255 [07:04<12:50,  4.19s/it] 28%|██▊       | 72/255 [07:28<31:29, 10.33s/it] 29%|██▊       | 73/255 [07:57<48:14, 15.91s/it] 29%|██▉       | 74/255 [08:00<35:45, 11.86s/it] 29%|██▉       | 75/255 [08:26<48:51, 16.29s/it] 30%|██▉       | 76/255 [08:29<36:45, 12.32s/it] 30%|███       | 77/255 [08:32<28:02,  9.45s/it] 31%|███       | 78/255 [08:35<22:09,  7.51s/it] 31%|███       | 79/255 [08:37<17:01,  5.81s/it] 31%|███▏      | 80/255 [08:39<13:51,  4.75s/it] 32%|███▏      | 81/255 [08:42<12:04,  4.16s/it] 32%|███▏      | 82/255 [08:43<09:48,  3.40s/it] 33%|███▎      | 83/255 [08:46<08:57,  3.13s/it] 33%|███▎      | 84/255 [08:48<08:10,  2.87s/it] 33%|███▎      | 85/255 [08:51<08:05,  2.85s/it] 34%|███▎      | 86/255 [08:54<07:50,  2.78s/it] 34%|███▍      | 87/255 [08:56<07:03,  2.52s/it] 35%|███▍      | 88/255 [08:59<07:22,  2.65s/it] 35%|███▍      | 89/255 [09:02<07:43,  2.79s/it] 35%|███▌      | 90/255 [09:05<07:53,  2.87s/it] 36%|███▌      | 91/255 [09:09<09:10,  3.36s/it] 36%|███▌      | 92/255 [09:12<08:54,  3.28s/it] 36%|███▋      | 93/255 [09:20<12:07,  4.49s/it] 37%|███▋      | 94/255 [09:21<09:37,  3.59s/it] 37%|███▋      | 95/255 [09:23<08:19,  3.12s/it] 38%|███▊      | 96/255 [09:25<07:20,  2.77s/it] 38%|███▊      | 97/255 [09:27<06:38,  2.52s/it] 38%|███▊      | 98/255 [09:30<07:03,  2.70s/it] 39%|███▉      | 99/255 [09:33<07:01,  2.70s/it] 39%|███▉      | 100/255 [09:35<06:49,  2.64s/it] 40%|███▉      | 101/255 [10:00<23:40,  9.23s/it] 40%|████      | 102/255 [10:25<35:25, 13.89s/it] 40%|████      | 103/255 [10:27<26:14, 10.36s/it] 41%|████      | 104/255 [10:29<19:58,  7.94s/it] 41%|████      | 105/255 [10:32<16:07,  6.45s/it] 42%|████▏     | 106/255 [10:35<13:13,  5.33s/it] 42%|████▏     | 107/255 [10:37<10:59,  4.45s/it] 42%|████▏     | 108/255 [10:40<09:21,  3.82s/it] 43%|████▎     | 109/255 [10:43<09:12,  3.78s/it] 43%|████▎     | 110/255 [10:46<08:15,  3.42s/it] 44%|████▎     | 111/255 [10:48<07:35,  3.16s/it] 44%|████▍     | 112/255 [10:51<06:53,  2.89s/it] 44%|████▍     | 113/255 [10:52<06:05,  2.58s/it] 45%|████▍     | 114/255 [10:54<05:10,  2.20s/it] 45%|████▌     | 115/255 [10:56<05:10,  2.22s/it] 45%|████▌     | 116/255 [10:58<04:43,  2.04s/it] 46%|████▌     | 117/255 [11:02<06:29,  2.82s/it] 46%|████▋     | 118/255 [11:04<05:53,  2.58s/it] 47%|████▋     | 119/255 [11:07<05:48,  2.56s/it] 47%|████▋     | 120/255 [11:09<05:35,  2.48s/it] 47%|████▋     | 121/255 [11:13<06:13,  2.79s/it] 48%|████▊     | 122/255 [11:15<06:07,  2.76s/it] 48%|████▊     | 123/255 [11:18<06:08,  2.79s/it] 49%|████▊     | 124/255 [11:20<05:39,  2.59s/it] 49%|████▉     | 125/255 [11:22<04:52,  2.25s/it] 49%|████▉     | 126/255 [11:23<04:20,  2.02s/it] 50%|████▉     | 127/255 [11:48<18:56,  8.88s/it] 50%|█████     | 128/255 [12:12<28:23, 13.41s/it] 51%|█████     | 129/255 [12:36<35:02, 16.69s/it] 51%|█████     | 130/255 [12:38<25:18, 12.15s/it] 51%|█████▏    | 131/255 [12:40<18:44,  9.07s/it] 52%|█████▏    | 132/255 [12:42<14:27,  7.05s/it] 52%|█████▏    | 133/255 [12:44<11:23,  5.60s/it] 53%|█████▎    | 134/255 [12:48<09:49,  4.87s/it] 53%|█████▎    | 135/255 [12:51<08:57,  4.48s/it] 53%|█████▎    | 136/255 [12:55<08:22,  4.22s/it] 54%|█████▎    | 137/255 [12:58<07:47,  3.96s/it] 54%|█████▍    | 138/255 [12:59<06:05,  3.12s/it] 55%|█████▍    | 139/255 [13:23<17:54,  9.26s/it] 55%|█████▍    | 140/255 [13:25<13:29,  7.04s/it] 55%|█████▌    | 141/255 [13:50<23:33, 12.40s/it] 56%|█████▌    | 142/255 [13:52<17:50,  9.47s/it] 56%|█████▌    | 143/255 [13:55<13:46,  7.38s/it] 56%|█████▋    | 144/255 [13:57<10:36,  5.73s/it] 57%|█████▋    | 145/255 [14:00<09:03,  4.94s/it] 57%|█████▋    | 146/255 [14:02<07:29,  4.13s/it] 58%|█████▊    | 147/255 [14:04<06:18,  3.51s/it] 58%|█████▊    | 148/255 [14:08<06:20,  3.56s/it] 58%|█████▊    | 149/255 [14:11<06:13,  3.52s/it] 59%|█████▉    | 150/255 [14:14<05:45,  3.29s/it] 59%|█████▉    | 151/255 [14:17<05:42,  3.30s/it] 60%|█████▉    | 152/255 [14:41<16:11,  9.43s/it] 60%|██████    | 153/255 [15:05<23:33, 13.86s/it] 60%|██████    | 154/255 [15:12<19:40, 11.69s/it] 61%|██████    | 155/255 [15:16<15:44,  9.45s/it] 61%|██████    | 156/255 [15:21<13:11,  8.00s/it] 62%|██████▏   | 157/255 [15:26<11:35,  7.10s/it] 62%|██████▏   | 158/255 [15:30<10:17,  6.36s/it] 62%|██████▏   | 159/255 [15:33<08:37,  5.39s/it] 63%|██████▎   | 160/255 [15:36<07:04,  4.47s/it] 63%|██████▎   | 161/255 [15:39<06:25,  4.10s/it] 64%|██████▎   | 162/255 [15:42<05:36,  3.62s/it] 64%|██████▍   | 163/255 [15:44<05:03,  3.30s/it] 64%|██████▍   | 164/255 [15:49<05:41,  3.76s/it] 65%|██████▍   | 165/255 [15:51<05:01,  3.35s/it] 65%|██████▌   | 166/255 [15:54<04:46,  3.22s/it] 65%|██████▌   | 167/255 [15:58<04:58,  3.39s/it] 66%|██████▌   | 168/255 [16:02<05:06,  3.52s/it] 66%|██████▋   | 169/255 [16:25<13:25,  9.36s/it] 67%|██████▋   | 170/255 [16:27<10:07,  7.15s/it] 67%|██████▋   | 171/255 [16:31<08:49,  6.30s/it] 67%|██████▋   | 172/255 [16:33<07:01,  5.08s/it] 68%|██████▊   | 173/255 [16:36<06:02,  4.42s/it] 68%|██████▊   | 174/255 [17:07<16:36, 12.30s/it] 69%|██████▊   | 175/255 [17:34<22:09, 16.62s/it] 69%|██████▉   | 176/255 [17:37<16:43, 12.70s/it] 69%|██████▉   | 177/255 [18:03<21:37, 16.63s/it] 70%|██████▉   | 178/255 [18:05<15:51, 12.36s/it] 70%|███████   | 179/255 [18:08<11:53,  9.38s/it] 71%|███████   | 180/255 [18:09<08:50,  7.07s/it] 71%|███████   | 181/255 [18:11<06:42,  5.43s/it] 71%|███████▏  | 182/255 [18:14<05:32,  4.56s/it] 72%|███████▏  | 183/255 [18:38<12:27, 10.38s/it] 72%|███████▏  | 184/255 [18:40<09:19,  7.89s/it] 73%|███████▎  | 185/255 [19:04<14:56, 12.80s/it] 73%|███████▎  | 186/255 [19:06<10:57,  9.52s/it] 73%|███████▎  | 187/255 [19:09<08:32,  7.53s/it] 74%|███████▎  | 188/255 [19:12<06:54,  6.18s/it] 74%|███████▍  | 189/255 [19:14<05:25,  4.93s/it] 75%|███████▍  | 190/255 [19:17<04:47,  4.43s/it] 75%|███████▍  | 191/255 [19:43<11:36, 10.88s/it] 75%|███████▌  | 192/255 [19:45<08:31,  8.11s/it] 76%|███████▌  | 193/255 [19:48<06:55,  6.71s/it] 76%|███████▌  | 194/255 [19:50<05:28,  5.38s/it] 76%|███████▋  | 195/255 [19:52<04:20,  4.33s/it] 77%|███████▋  | 196/255 [19:54<03:34,  3.64s/it] 77%|███████▋  | 197/255 [19:57<03:16,  3.39s/it] 78%|███████▊  | 198/255 [19:59<02:46,  2.92s/it] 78%|███████▊  | 199/255 [20:04<03:13,  3.45s/it] 78%|███████▊  | 200/255 [20:30<09:33, 10.42s/it] 79%|███████▉  | 201/255 [20:57<13:42, 15.24s/it] 79%|███████▉  | 202/255 [20:58<09:52, 11.18s/it] 80%|███████▉  | 203/255 [21:02<07:36,  8.79s/it] 80%|████████  | 204/255 [21:06<06:23,  7.52s/it] 80%|████████  | 205/255 [21:09<05:09,  6.19s/it] 81%|████████  | 206/255 [21:13<04:25,  5.41s/it] 81%|████████  | 207/255 [21:15<03:29,  4.36s/it] 82%|████████▏ | 208/255 [21:17<02:58,  3.80s/it] 82%|████████▏ | 209/255 [21:20<02:34,  3.35s/it] 82%|████████▏ | 210/255 [21:23<02:26,  3.26s/it] 83%|████████▎ | 211/255 [21:25<02:07,  2.90s/it] 83%|████████▎ | 212/255 [21:28<02:14,  3.13s/it] 84%|████████▎ | 213/255 [21:30<01:58,  2.82s/it] 84%|████████▍ | 214/255 [21:32<01:40,  2.46s/it] 84%|████████▍ | 215/255 [21:35<01:43,  2.59s/it] 85%|████████▍ | 216/255 [21:38<01:44,  2.68s/it] 85%|████████▌ | 217/255 [21:40<01:34,  2.49s/it] 85%|████████▌ | 218/255 [21:42<01:29,  2.42s/it] 86%|████████▌ | 219/255 [22:06<05:17,  8.81s/it] 86%|████████▋ | 220/255 [22:08<03:54,  6.71s/it] 87%|████████▋ | 221/255 [22:09<02:55,  5.16s/it] 87%|████████▋ | 222/255 [22:12<02:25,  4.42s/it] 87%|████████▋ | 223/255 [22:16<02:21,  4.42s/it] 88%|████████▊ | 224/255 [22:19<02:04,  4.02s/it] 88%|████████▊ | 225/255 [22:23<01:53,  3.77s/it] 89%|████████▊ | 226/255 [22:24<01:32,  3.18s/it] 89%|████████▉ | 227/255 [22:26<01:14,  2.67s/it] 89%|████████▉ | 228/255 [22:30<01:26,  3.19s/it] 90%|████████▉ | 229/255 [22:33<01:20,  3.08s/it] 90%|█████████ | 230/255 [22:36<01:16,  3.04s/it] 91%|█████████ | 231/255 [22:39<01:11,  2.99s/it] 91%|█████████ | 232/255 [23:05<03:50, 10.01s/it] 91%|█████████▏| 233/255 [23:32<05:28, 14.92s/it] 92%|█████████▏| 234/255 [23:33<03:48, 10.89s/it] 92%|█████████▏| 235/255 [23:35<02:44,  8.23s/it] 93%|█████████▎| 236/255 [23:37<01:57,  6.20s/it] 93%|█████████▎| 237/255 [23:40<01:35,  5.31s/it] 93%|█████████▎| 238/255 [23:43<01:21,  4.80s/it] 94%|█████████▎| 239/255 [23:47<01:12,  4.53s/it] 94%|█████████▍| 240/255 [23:52<01:08,  4.57s/it] 95%|█████████▍| 241/255 [23:56<01:01,  4.39s/it] 95%|█████████▍| 242/255 [23:59<00:50,  3.86s/it] 95%|█████████▌| 243/255 [24:01<00:42,  3.56s/it] 96%|█████████▌| 244/255 [24:05<00:37,  3.42s/it] 96%|█████████▌| 245/255 [24:07<00:30,  3.08s/it] 96%|█████████▋| 246/255 [24:12<00:33,  3.69s/it] 97%|█████████▋| 247/255 [24:16<00:30,  3.76s/it] 97%|█████████▋| 248/255 [24:18<00:22,  3.16s/it] 98%|█████████▊| 249/255 [24:19<00:16,  2.67s/it] 98%|█████████▊| 250/255 [24:21<00:11,  2.27s/it] 98%|█████████▊| 251/255 [24:22<00:08,  2.04s/it] 99%|█████████▉| 252/255 [24:26<00:08,  2.74s/it] 99%|█████████▉| 253/255 [24:29<00:05,  2.76s/it]100%|█████████▉| 254/255 [24:33<00:03,  3.09s/it]100%|██████████| 255/255 [24:35<00:00,  2.67s/it]100%|██████████| 255/255 [24:35<00:00,  5.79s/it]
2024-10-03 00:20:14,600 - INFO - Completed evaluation for en-de. Results saved to /home/scur1769/ALMA-Matters/evaluation/results/30-slice/result_en-de.txt
Processing file: /home/scur1769/ALMA-Matters/datasets/human-translations/ALMA_test_en-is.json
2024-10-03 00:20:18,522 - INFO - Loading sliced haoranxu/ALMA-7B model from /home/scur1769/ALMA-Matters/models with sparsity 0.3
2024-10-03 00:20:18,523 - INFO - Loading haoranxu/ALMA-7B config from Hugging Face
Using LlamaAdapter for ALMA-7B
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:01<00:02,  1.16s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:02<00:01,  1.14s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:03<00:00,  1.02it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:03<00:00,  1.03s/it]
2024-10-03 00:20:22,717 - INFO - Loading model done
2024-10-03 00:20:22,717 - INFO - Replacing layers
2024-10-03 00:20:23,594 - INFO - Replacing layers done
2024-10-03 00:20:23,594 - INFO - Fusing layernorm modules
2024-10-03 00:20:26,542 - INFO - Fusing layernorm modules done
2024-10-03 00:20:26,763 - INFO - Loading sliced model weights from /home/scur1769/ALMA-Matters/models
/gpfs/home4/scur1769/ALMA-Matters/compression/pruning/TransformerCompression/src/slicegpt/hf_utils.py:183: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  torch.load(str(pathlib.Path(sliced_model_path) / my_sliced_model_name), map_location="cpu")
2024-10-03 00:20:32,417 - INFO - Model dtype: torch.float16
  0%|          | 0/125 [00:00<?, ?it/s]  1%|          | 1/125 [00:10<22:06, 10.70s/it]  2%|▏         | 2/125 [00:15<14:55,  7.28s/it]  2%|▏         | 3/125 [00:42<32:36, 16.04s/it]  3%|▎         | 4/125 [01:11<42:57, 21.31s/it]  4%|▍         | 5/125 [01:15<30:27, 15.23s/it]  5%|▍         | 6/125 [01:19<22:02, 11.12s/it]  6%|▌         | 7/125 [01:47<33:06, 16.83s/it]  6%|▋         | 8/125 [01:51<24:39, 12.64s/it]  7%|▋         | 9/125 [02:20<34:39, 17.93s/it]  8%|▊         | 10/125 [02:49<40:39, 21.21s/it]  9%|▉         | 11/125 [02:52<29:54, 15.74s/it] 10%|▉         | 12/125 [02:56<22:52, 12.15s/it] 10%|█         | 13/125 [03:23<31:04, 16.64s/it] 11%|█         | 14/125 [03:52<37:38, 20.34s/it] 12%|█▏        | 15/125 [04:17<39:40, 21.64s/it] 13%|█▎        | 16/125 [04:20<29:03, 16.00s/it] 14%|█▎        | 17/125 [04:52<37:35, 20.88s/it] 14%|█▍        | 18/125 [05:01<31:05, 17.44s/it] 15%|█▌        | 19/125 [05:03<22:44, 12.87s/it] 16%|█▌        | 20/125 [05:32<30:58, 17.70s/it] 17%|█▋        | 21/125 [06:04<37:46, 21.79s/it] 18%|█▊        | 22/125 [06:07<27:53, 16.24s/it] 18%|█▊        | 23/125 [06:10<20:38, 12.15s/it] 19%|█▉        | 24/125 [06:15<16:52, 10.03s/it] 20%|██        | 25/125 [06:41<24:42, 14.82s/it] 21%|██        | 26/125 [06:44<18:46, 11.37s/it] 22%|██▏       | 27/125 [07:15<28:14, 17.29s/it] 22%|██▏       | 28/125 [07:18<20:46, 12.85s/it] 23%|██▎       | 29/125 [07:21<16:12, 10.13s/it] 24%|██▍       | 30/125 [07:29<14:35,  9.22s/it] 25%|██▍       | 31/125 [07:55<22:42, 14.50s/it] 26%|██▌       | 32/125 [07:58<17:08, 11.05s/it] 26%|██▋       | 33/125 [08:02<13:24,  8.74s/it] 27%|██▋       | 34/125 [08:04<10:19,  6.81s/it] 28%|██▊       | 35/125 [08:33<20:10, 13.45s/it] 29%|██▉       | 36/125 [08:38<16:03, 10.83s/it] 30%|██▉       | 37/125 [08:42<12:58,  8.84s/it] 30%|███       | 38/125 [08:46<10:32,  7.27s/it] 31%|███       | 39/125 [08:49<08:42,  6.07s/it] 32%|███▏      | 40/125 [09:18<18:15, 12.89s/it] 33%|███▎      | 41/125 [09:48<25:16, 18.06s/it] 34%|███▎      | 42/125 [10:19<30:21, 21.95s/it] 34%|███▍      | 43/125 [10:47<32:42, 23.94s/it] 35%|███▌      | 44/125 [10:50<23:51, 17.68s/it] 36%|███▌      | 45/125 [11:19<27:58, 20.98s/it] 37%|███▋      | 46/125 [11:22<20:26, 15.52s/it] 38%|███▊      | 47/125 [11:51<25:40, 19.75s/it] 38%|███▊      | 48/125 [12:20<28:42, 22.37s/it] 39%|███▉      | 49/125 [12:47<29:57, 23.66s/it] 40%|████      | 50/125 [12:50<22:05, 17.67s/it] 41%|████      | 51/125 [13:21<26:39, 21.62s/it] 42%|████▏     | 52/125 [13:24<19:32, 16.06s/it] 42%|████▏     | 53/125 [13:51<23:05, 19.24s/it] 43%|████▎     | 54/125 [14:16<24:45, 20.93s/it] 44%|████▍     | 55/125 [14:42<26:23, 22.62s/it] 45%|████▍     | 56/125 [14:45<19:05, 16.61s/it] 46%|████▌     | 57/125 [15:16<23:34, 20.81s/it] 46%|████▋     | 58/125 [15:19<17:28, 15.65s/it] 47%|████▋     | 59/125 [15:21<12:43, 11.56s/it] 48%|████▊     | 60/125 [15:45<16:34, 15.30s/it] 49%|████▉     | 61/125 [15:48<12:20, 11.57s/it] 50%|████▉     | 62/125 [15:52<09:40,  9.21s/it] 50%|█████     | 63/125 [15:56<08:03,  7.80s/it] 51%|█████     | 64/125 [16:00<06:46,  6.67s/it] 52%|█████▏    | 65/125 [16:28<12:55, 12.93s/it] 53%|█████▎    | 66/125 [16:55<16:48, 17.10s/it] 54%|█████▎    | 67/125 [17:20<19:02, 19.69s/it] 54%|█████▍    | 68/125 [17:50<21:27, 22.59s/it] 55%|█████▌    | 69/125 [18:19<22:51, 24.49s/it] 56%|█████▌    | 70/125 [18:22<16:34, 18.08s/it] 57%|█████▋    | 71/125 [18:27<12:50, 14.28s/it] 58%|█████▊    | 72/125 [18:29<09:23, 10.64s/it] 58%|█████▊    | 73/125 [18:32<07:14,  8.36s/it] 59%|█████▉    | 74/125 [18:36<05:50,  6.88s/it] 60%|██████    | 75/125 [18:39<04:55,  5.91s/it] 61%|██████    | 76/125 [18:44<04:27,  5.46s/it] 62%|██████▏   | 77/125 [18:50<04:25,  5.53s/it] 62%|██████▏   | 78/125 [19:19<10:02, 12.81s/it] 63%|██████▎   | 79/125 [19:50<13:51, 18.08s/it] 64%|██████▍   | 80/125 [20:17<15:32, 20.72s/it] 65%|██████▍   | 81/125 [20:21<11:30, 15.70s/it] 66%|██████▌   | 82/125 [20:24<08:39, 12.07s/it] 66%|██████▋   | 83/125 [20:28<06:36,  9.44s/it] 67%|██████▋   | 84/125 [20:31<05:15,  7.68s/it] 68%|██████▊   | 85/125 [20:35<04:23,  6.60s/it] 69%|██████▉   | 86/125 [20:41<04:09,  6.40s/it] 70%|██████▉   | 87/125 [21:09<08:11, 12.94s/it] 70%|███████   | 88/125 [21:36<10:36, 17.19s/it] 71%|███████   | 89/125 [21:40<07:48, 13.02s/it] 72%|███████▏  | 90/125 [21:43<05:56, 10.18s/it] 73%|███████▎  | 91/125 [21:53<05:37,  9.91s/it] 74%|███████▎  | 92/125 [21:56<04:24,  8.00s/it] 74%|███████▍  | 93/125 [22:22<07:07, 13.36s/it] 75%|███████▌  | 94/125 [22:53<09:39, 18.70s/it] 76%|███████▌  | 95/125 [23:20<10:37, 21.26s/it] 77%|███████▋  | 96/125 [23:50<11:32, 23.88s/it] 78%|███████▊  | 97/125 [24:17<11:28, 24.58s/it] 78%|███████▊  | 98/125 [24:20<08:09, 18.11s/it] 79%|███████▉  | 99/125 [24:47<09:05, 20.98s/it] 80%|████████  | 100/125 [24:51<06:33, 15.76s/it] 81%|████████  | 101/125 [24:56<05:00, 12.53s/it] 82%|████████▏ | 102/125 [25:25<06:43, 17.53s/it] 82%|████████▏ | 103/125 [25:54<07:42, 21.00s/it] 83%|████████▎ | 104/125 [25:58<05:33, 15.90s/it] 84%|████████▍ | 105/125 [26:28<06:43, 20.18s/it] 85%|████████▍ | 106/125 [26:32<04:47, 15.12s/it] 86%|████████▌ | 107/125 [26:34<03:24, 11.38s/it] 86%|████████▋ | 108/125 [26:38<02:36,  9.18s/it] 87%|████████▋ | 109/125 [26:41<01:57,  7.37s/it] 88%|████████▊ | 110/125 [26:45<01:32,  6.19s/it] 89%|████████▉ | 111/125 [27:16<03:11, 13.66s/it] 90%|████████▉ | 112/125 [27:46<04:00, 18.52s/it] 90%|█████████ | 113/125 [27:49<02:47, 13.93s/it] 91%|█████████ | 114/125 [28:14<03:09, 17.19s/it] 92%|█████████▏| 115/125 [28:40<03:19, 19.93s/it] 93%|█████████▎| 116/125 [29:09<03:23, 22.60s/it] 94%|█████████▎| 117/125 [29:13<02:16, 17.02s/it] 94%|█████████▍| 118/125 [29:18<01:33, 13.42s/it] 95%|█████████▌| 119/125 [29:21<01:02, 10.38s/it] 96%|█████████▌| 120/125 [29:54<01:24, 16.99s/it] 97%|█████████▋| 121/125 [30:00<00:54, 13.67s/it] 98%|█████████▊| 122/125 [30:28<00:54, 18.09s/it] 98%|█████████▊| 123/125 [30:31<00:26, 13.49s/it] 99%|█████████▉| 124/125 [30:34<00:10, 10.37s/it]100%|██████████| 125/125 [31:01<00:00, 15.47s/it]100%|██████████| 125/125 [31:01<00:00, 14.89s/it]
2024-10-03 00:51:34,239 - INFO - Completed evaluation for en-is. Results saved to /home/scur1769/ALMA-Matters/evaluation/results/30-slice/result_en-is.txt
Processing file: /home/scur1769/ALMA-Matters/datasets/human-translations/ALMA_test_en-ru.json
2024-10-03 00:51:38,219 - INFO - Loading sliced haoranxu/ALMA-7B model from /home/scur1769/ALMA-Matters/models with sparsity 0.3
2024-10-03 00:51:38,219 - INFO - Loading haoranxu/ALMA-7B config from Hugging Face
Using LlamaAdapter for ALMA-7B
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:01<00:02,  1.12s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:02<00:01,  1.11s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:03<00:00,  1.04it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:03<00:00,  1.00s/it]
2024-10-03 00:51:42,910 - INFO - Loading model done
2024-10-03 00:51:42,910 - INFO - Replacing layers
2024-10-03 00:51:43,815 - INFO - Replacing layers done
2024-10-03 00:51:43,815 - INFO - Fusing layernorm modules
2024-10-03 00:51:46,754 - INFO - Fusing layernorm modules done
2024-10-03 00:51:46,984 - INFO - Loading sliced model weights from /home/scur1769/ALMA-Matters/models
/gpfs/home4/scur1769/ALMA-Matters/compression/pruning/TransformerCompression/src/slicegpt/hf_utils.py:183: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  torch.load(str(pathlib.Path(sliced_model_path) / my_sliced_model_name), map_location="cpu")
2024-10-03 00:51:52,601 - INFO - Model dtype: torch.float16
  0%|          | 0/255 [00:00<?, ?it/s]  0%|          | 1/255 [00:02<08:44,  2.07s/it]  1%|          | 2/255 [00:03<08:22,  1.99s/it]  1%|          | 3/255 [00:05<07:11,  1.71s/it]  2%|▏         | 4/255 [00:08<09:05,  2.17s/it]  2%|▏         | 5/255 [00:11<10:32,  2.53s/it]  2%|▏         | 6/255 [00:14<11:38,  2.80s/it]  3%|▎         | 7/255 [00:17<11:27,  2.77s/it]  3%|▎         | 8/255 [00:18<09:45,  2.37s/it]  4%|▎         | 9/255 [00:43<37:44,  9.20s/it]  4%|▍         | 10/255 [00:44<27:32,  6.74s/it]  4%|▍         | 11/255 [00:46<21:19,  5.24s/it]  5%|▍         | 12/255 [00:48<17:01,  4.20s/it]  5%|▌         | 13/255 [00:51<15:44,  3.90s/it]  5%|▌         | 14/255 [00:55<15:39,  3.90s/it]  6%|▌         | 15/255 [00:58<15:24,  3.85s/it]  6%|▋         | 16/255 [01:02<15:03,  3.78s/it]  7%|▋         | 17/255 [01:04<13:15,  3.34s/it]  7%|▋         | 18/255 [01:07<12:54,  3.27s/it]  7%|▋         | 19/255 [01:12<13:53,  3.53s/it]  8%|▊         | 20/255 [01:15<13:05,  3.34s/it]  8%|▊         | 21/255 [01:17<12:19,  3.16s/it]  9%|▊         | 22/255 [01:20<12:01,  3.10s/it]  9%|▉         | 23/255 [01:24<12:55,  3.34s/it]  9%|▉         | 24/255 [01:26<10:49,  2.81s/it] 10%|▉         | 25/255 [01:50<35:07,  9.16s/it] 10%|█         | 26/255 [02:14<52:25, 13.74s/it] 11%|█         | 27/255 [02:16<38:43, 10.19s/it] 11%|█         | 28/255 [02:19<30:25,  8.04s/it] 11%|█▏        | 29/255 [02:22<24:22,  6.47s/it] 12%|█▏        | 30/255 [02:24<19:15,  5.14s/it] 12%|█▏        | 31/255 [02:28<17:29,  4.69s/it] 13%|█▎        | 32/255 [02:30<14:33,  3.91s/it] 13%|█▎        | 33/255 [02:33<13:54,  3.76s/it] 13%|█▎        | 34/255 [02:57<35:53,  9.74s/it] 14%|█▎        | 35/255 [03:21<51:42, 14.10s/it] 14%|█▍        | 36/255 [03:46<1:03:08, 17.30s/it] 15%|█▍        | 37/255 [04:12<1:12:44, 20.02s/it] 15%|█▍        | 38/255 [04:16<54:46, 15.14s/it]   15%|█▌        | 39/255 [04:19<41:34, 11.55s/it] 16%|█▌        | 40/255 [04:21<31:29,  8.79s/it] 16%|█▌        | 41/255 [04:23<24:05,  6.76s/it] 16%|█▋        | 42/255 [04:26<19:33,  5.51s/it] 17%|█▋        | 43/255 [04:29<16:18,  4.62s/it] 17%|█▋        | 44/255 [04:30<13:13,  3.76s/it] 18%|█▊        | 45/255 [04:32<11:05,  3.17s/it] 18%|█▊        | 46/255 [04:37<12:25,  3.57s/it] 18%|█▊        | 47/255 [04:39<11:35,  3.34s/it] 19%|█▉        | 48/255 [04:42<10:46,  3.13s/it] 19%|█▉        | 49/255 [04:44<09:35,  2.79s/it] 20%|█▉        | 50/255 [04:46<08:48,  2.58s/it] 20%|██        | 51/255 [04:51<10:36,  3.12s/it] 20%|██        | 52/255 [04:53<10:02,  2.97s/it] 21%|██        | 53/255 [04:57<10:50,  3.22s/it] 21%|██        | 54/255 [04:59<09:15,  2.77s/it] 22%|██▏       | 55/255 [05:03<10:53,  3.27s/it] 22%|██▏       | 56/255 [05:07<11:27,  3.46s/it] 22%|██▏       | 57/255 [05:14<15:15,  4.62s/it] 23%|██▎       | 58/255 [05:16<11:56,  3.64s/it] 23%|██▎       | 59/255 [05:20<12:34,  3.85s/it] 24%|██▎       | 60/255 [05:24<12:32,  3.86s/it] 24%|██▍       | 61/255 [05:27<11:20,  3.51s/it] 24%|██▍       | 62/255 [05:28<09:23,  2.92s/it] 25%|██▍       | 63/255 [05:30<08:37,  2.70s/it] 25%|██▌       | 64/255 [05:33<08:11,  2.57s/it] 25%|██▌       | 65/255 [05:35<07:39,  2.42s/it] 26%|██▌       | 66/255 [05:37<07:14,  2.30s/it] 26%|██▋       | 67/255 [05:38<06:24,  2.05s/it] 27%|██▋       | 68/255 [05:41<07:27,  2.39s/it] 27%|██▋       | 69/255 [05:43<06:52,  2.22s/it] 27%|██▋       | 70/255 [05:46<07:04,  2.30s/it] 28%|██▊       | 71/255 [05:48<07:04,  2.31s/it] 28%|██▊       | 72/255 [05:50<07:02,  2.31s/it] 29%|██▊       | 73/255 [05:52<06:53,  2.27s/it] 29%|██▉       | 74/255 [05:56<08:01,  2.66s/it] 29%|██▉       | 75/255 [05:59<08:36,  2.87s/it] 30%|██▉       | 76/255 [06:02<08:27,  2.84s/it] 30%|███       | 77/255 [06:04<07:43,  2.61s/it] 31%|███       | 78/255 [06:08<08:37,  2.93s/it] 31%|███       | 79/255 [06:11<08:44,  2.98s/it] 31%|███▏      | 80/255 [06:14<08:30,  2.92s/it] 32%|███▏      | 81/255 [06:15<07:17,  2.52s/it] 32%|███▏      | 82/255 [06:20<08:57,  3.11s/it] 33%|███▎      | 83/255 [06:23<08:56,  3.12s/it] 33%|███▎      | 84/255 [06:26<08:51,  3.11s/it] 33%|███▎      | 85/255 [06:52<28:16,  9.98s/it] 34%|███▎      | 86/255 [06:55<22:21,  7.94s/it] 34%|███▍      | 87/255 [07:00<19:20,  6.91s/it] 35%|███▍      | 88/255 [07:06<19:03,  6.84s/it] 35%|███▍      | 89/255 [07:11<16:46,  6.06s/it] 35%|███▌      | 90/255 [07:14<14:06,  5.13s/it] 36%|███▌      | 91/255 [07:17<12:15,  4.48s/it] 36%|███▌      | 92/255 [07:19<10:44,  3.96s/it] 36%|███▋      | 93/255 [07:22<09:34,  3.55s/it] 37%|███▋      | 94/255 [07:24<08:41,  3.24s/it] 37%|███▋      | 95/255 [07:26<07:05,  2.66s/it] 38%|███▊      | 96/255 [07:28<06:22,  2.41s/it] 38%|███▊      | 97/255 [07:29<05:29,  2.08s/it] 38%|███▊      | 98/255 [07:55<23:56,  9.15s/it] 39%|███▉      | 99/255 [08:02<22:27,  8.64s/it] 39%|███▉      | 100/255 [08:04<17:11,  6.65s/it] 40%|███▉      | 101/255 [08:08<14:46,  5.76s/it] 40%|████      | 102/255 [08:11<13:13,  5.19s/it] 40%|████      | 103/255 [08:16<12:44,  5.03s/it] 41%|████      | 104/255 [08:19<11:13,  4.46s/it] 41%|████      | 105/255 [08:23<10:26,  4.18s/it] 42%|████▏     | 106/255 [08:24<08:18,  3.34s/it] 42%|████▏     | 107/255 [08:48<23:18,  9.45s/it] 42%|████▏     | 108/255 [08:49<17:20,  7.08s/it] 43%|████▎     | 109/255 [08:53<14:33,  5.98s/it] 43%|████▎     | 110/255 [08:57<13:22,  5.54s/it] 44%|████▎     | 111/255 [09:03<13:05,  5.46s/it] 44%|████▍     | 112/255 [09:05<10:31,  4.42s/it] 44%|████▍     | 113/255 [09:07<08:51,  3.74s/it] 45%|████▍     | 114/255 [09:09<07:30,  3.19s/it] 45%|████▌     | 115/255 [09:11<06:34,  2.81s/it] 45%|████▌     | 116/255 [09:34<21:02,  9.08s/it] 46%|████▌     | 117/255 [09:37<16:16,  7.08s/it] 46%|████▋     | 118/255 [10:02<28:25, 12.45s/it] 47%|████▋     | 119/255 [10:25<35:48, 15.79s/it] 47%|████▋     | 120/255 [10:27<26:06, 11.60s/it] 47%|████▋     | 121/255 [10:29<19:05,  8.55s/it] 48%|████▊     | 122/255 [10:32<15:38,  7.05s/it] 48%|████▊     | 123/255 [10:37<13:52,  6.31s/it] 49%|████▊     | 124/255 [10:40<12:00,  5.50s/it] 49%|████▉     | 125/255 [10:43<10:20,  4.77s/it] 49%|████▉     | 126/255 [10:47<09:27,  4.40s/it] 50%|████▉     | 127/255 [10:50<08:26,  3.95s/it] 50%|█████     | 128/255 [10:53<07:53,  3.73s/it] 51%|█████     | 129/255 [11:19<21:46, 10.37s/it] 51%|█████     | 130/255 [11:20<16:02,  7.70s/it] 51%|█████▏    | 131/255 [11:22<12:23,  6.00s/it] 52%|█████▏    | 132/255 [11:25<10:21,  5.05s/it] 52%|█████▏    | 133/255 [11:27<08:13,  4.04s/it] 53%|█████▎    | 134/255 [11:30<07:40,  3.81s/it] 53%|█████▎    | 135/255 [11:33<06:46,  3.39s/it] 53%|█████▎    | 136/255 [11:43<10:40,  5.38s/it] 54%|█████▎    | 137/255 [11:45<09:00,  4.58s/it] 54%|█████▍    | 138/255 [11:49<08:17,  4.25s/it] 55%|█████▍    | 139/255 [11:52<07:21,  3.81s/it] 55%|█████▍    | 140/255 [11:54<06:21,  3.32s/it] 55%|█████▌    | 141/255 [11:56<05:45,  3.03s/it] 56%|█████▌    | 142/255 [11:58<04:57,  2.63s/it] 56%|█████▌    | 143/255 [12:03<06:20,  3.40s/it] 56%|█████▋    | 144/255 [12:05<05:37,  3.04s/it] 57%|█████▋    | 145/255 [12:08<05:33,  3.03s/it] 57%|█████▋    | 146/255 [12:11<05:34,  3.06s/it] 58%|█████▊    | 147/255 [12:13<04:40,  2.60s/it] 58%|█████▊    | 148/255 [12:15<04:29,  2.52s/it] 58%|█████▊    | 149/255 [12:20<05:43,  3.24s/it] 59%|█████▉    | 150/255 [12:23<05:12,  2.98s/it] 59%|█████▉    | 151/255 [12:25<04:53,  2.82s/it] 60%|█████▉    | 152/255 [12:27<04:22,  2.55s/it] 60%|██████    | 153/255 [12:30<04:34,  2.69s/it] 60%|██████    | 154/255 [12:33<04:33,  2.71s/it] 61%|██████    | 155/255 [12:35<04:07,  2.47s/it] 61%|██████    | 156/255 [12:59<15:05,  9.15s/it] 62%|██████▏   | 157/255 [13:02<11:51,  7.26s/it] 62%|██████▏   | 158/255 [13:05<09:44,  6.03s/it] 62%|██████▏   | 159/255 [13:08<08:07,  5.08s/it] 63%|██████▎   | 160/255 [13:11<06:57,  4.39s/it] 63%|██████▎   | 161/255 [13:14<06:02,  3.85s/it] 64%|██████▎   | 162/255 [13:17<05:38,  3.64s/it] 64%|██████▍   | 163/255 [13:19<04:52,  3.18s/it] 64%|██████▍   | 164/255 [13:20<04:06,  2.71s/it] 65%|██████▍   | 165/255 [13:25<04:48,  3.21s/it] 65%|██████▌   | 166/255 [13:27<04:19,  2.92s/it] 65%|██████▌   | 167/255 [13:29<03:47,  2.58s/it] 66%|██████▌   | 168/255 [13:31<03:28,  2.40s/it] 66%|██████▋   | 169/255 [13:34<03:33,  2.49s/it] 67%|██████▋   | 170/255 [13:38<04:16,  3.02s/it] 67%|██████▋   | 171/255 [13:41<04:09,  2.97s/it] 67%|██████▋   | 172/255 [13:46<05:17,  3.82s/it] 68%|██████▊   | 173/255 [13:51<05:29,  4.02s/it] 68%|██████▊   | 174/255 [13:54<04:50,  3.59s/it] 69%|██████▊   | 175/255 [13:57<04:39,  3.49s/it] 69%|██████▉   | 176/255 [14:00<04:39,  3.54s/it] 69%|██████▉   | 177/255 [14:02<04:00,  3.09s/it] 70%|██████▉   | 178/255 [14:04<03:19,  2.59s/it] 70%|███████   | 179/255 [14:07<03:30,  2.78s/it] 71%|███████   | 180/255 [14:10<03:33,  2.85s/it] 71%|███████   | 181/255 [14:13<03:33,  2.89s/it] 71%|███████▏  | 182/255 [14:15<02:59,  2.46s/it] 72%|███████▏  | 183/255 [14:17<03:04,  2.56s/it] 72%|███████▏  | 184/255 [14:20<03:05,  2.62s/it] 73%|███████▎  | 185/255 [14:24<03:29,  2.99s/it] 73%|███████▎  | 186/255 [14:27<03:34,  3.11s/it] 73%|███████▎  | 187/255 [14:30<03:13,  2.84s/it] 74%|███████▎  | 188/255 [14:32<02:59,  2.68s/it] 74%|███████▍  | 189/255 [14:33<02:32,  2.31s/it] 75%|███████▍  | 190/255 [14:37<03:04,  2.84s/it] 75%|███████▍  | 191/255 [14:42<03:38,  3.42s/it] 75%|███████▌  | 192/255 [14:46<03:34,  3.41s/it] 76%|███████▌  | 193/255 [15:12<10:33, 10.21s/it] 76%|███████▌  | 194/255 [15:14<07:55,  7.79s/it] 76%|███████▋  | 195/255 [15:16<06:06,  6.11s/it] 77%|███████▋  | 196/255 [15:18<04:48,  4.89s/it] 77%|███████▋  | 197/255 [15:19<03:41,  3.81s/it] 78%|███████▊  | 198/255 [15:22<03:14,  3.42s/it] 78%|███████▊  | 199/255 [15:26<03:32,  3.79s/it] 78%|███████▊  | 200/255 [15:31<03:33,  3.88s/it] 79%|███████▉  | 201/255 [15:57<09:28, 10.53s/it] 79%|███████▉  | 202/255 [15:59<07:10,  8.13s/it] 80%|███████▉  | 203/255 [16:02<05:39,  6.53s/it] 80%|████████  | 204/255 [16:07<05:03,  5.96s/it] 80%|████████  | 205/255 [16:09<04:08,  4.97s/it] 81%|████████  | 206/255 [16:13<03:40,  4.50s/it] 81%|████████  | 207/255 [16:15<03:07,  3.91s/it] 82%|████████▏ | 208/255 [16:19<03:02,  3.88s/it] 82%|████████▏ | 209/255 [16:21<02:29,  3.26s/it] 82%|████████▏ | 210/255 [16:22<02:04,  2.77s/it] 83%|████████▎ | 211/255 [16:24<01:52,  2.56s/it] 83%|████████▎ | 212/255 [16:26<01:36,  2.25s/it] 84%|████████▎ | 213/255 [16:27<01:24,  2.02s/it] 84%|████████▍ | 214/255 [16:30<01:34,  2.30s/it] 84%|████████▍ | 215/255 [16:33<01:30,  2.27s/it] 85%|████████▍ | 216/255 [16:34<01:22,  2.11s/it] 85%|████████▌ | 217/255 [16:36<01:16,  2.01s/it] 85%|████████▌ | 218/255 [17:02<05:39,  9.18s/it] 86%|████████▌ | 219/255 [17:04<04:17,  7.16s/it] 86%|████████▋ | 220/255 [17:08<03:30,  6.01s/it] 87%|████████▋ | 221/255 [17:10<02:46,  4.90s/it] 87%|████████▋ | 222/255 [17:12<02:13,  4.04s/it] 87%|████████▋ | 223/255 [17:38<05:39, 10.61s/it] 88%|████████▊ | 224/255 [17:40<04:09,  8.05s/it] 88%|████████▊ | 225/255 [17:42<03:08,  6.27s/it] 89%|████████▊ | 226/255 [17:45<02:30,  5.21s/it] 89%|████████▉ | 227/255 [17:47<02:00,  4.30s/it] 89%|████████▉ | 228/255 [17:50<01:41,  3.75s/it] 90%|████████▉ | 229/255 [17:52<01:22,  3.17s/it] 90%|█████████ | 230/255 [17:54<01:14,  2.97s/it] 91%|█████████ | 231/255 [18:19<03:47,  9.48s/it] 91%|█████████ | 232/255 [18:20<02:45,  7.18s/it] 91%|█████████▏| 233/255 [18:45<04:35, 12.52s/it] 92%|█████████▏| 234/255 [18:48<03:17,  9.40s/it] 92%|█████████▏| 235/255 [18:49<02:22,  7.14s/it] 93%|█████████▎| 236/255 [18:51<01:45,  5.53s/it] 93%|█████████▎| 237/255 [18:53<01:17,  4.31s/it] 93%|█████████▎| 238/255 [18:55<01:04,  3.81s/it] 94%|█████████▎| 239/255 [18:57<00:51,  3.24s/it] 94%|█████████▍| 240/255 [19:00<00:47,  3.19s/it] 95%|█████████▍| 241/255 [19:05<00:50,  3.61s/it] 95%|█████████▍| 242/255 [19:10<00:53,  4.09s/it] 95%|█████████▌| 243/255 [19:13<00:46,  3.85s/it] 96%|█████████▌| 244/255 [19:16<00:38,  3.52s/it] 96%|█████████▌| 245/255 [19:19<00:32,  3.28s/it] 96%|█████████▋| 246/255 [19:21<00:26,  2.92s/it] 97%|█████████▋| 247/255 [19:24<00:23,  2.96s/it] 97%|█████████▋| 248/255 [19:28<00:22,  3.24s/it] 98%|█████████▊| 249/255 [19:30<00:17,  2.93s/it] 98%|█████████▊| 250/255 [19:32<00:12,  2.54s/it] 98%|█████████▊| 251/255 [19:36<00:11,  2.98s/it] 99%|█████████▉| 252/255 [19:38<00:08,  2.77s/it] 99%|█████████▉| 253/255 [19:40<00:04,  2.49s/it]100%|█████████▉| 254/255 [19:42<00:02,  2.34s/it]100%|██████████| 255/255 [19:44<00:00,  2.32s/it]100%|██████████| 255/255 [19:44<00:00,  4.65s/it]
2024-10-03 01:11:37,228 - INFO - Completed evaluation for en-ru. Results saved to /home/scur1769/ALMA-Matters/evaluation/results/30-slice/result_en-ru.txt
Processing file: /home/scur1769/ALMA-Matters/datasets/human-translations/ALMA_test_en-zh.json
2024-10-03 01:11:41,137 - INFO - Loading sliced haoranxu/ALMA-7B model from /home/scur1769/ALMA-Matters/models with sparsity 0.3
2024-10-03 01:11:41,137 - INFO - Loading haoranxu/ALMA-7B config from Hugging Face
Using LlamaAdapter for ALMA-7B
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:01<00:02,  1.14s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:02<00:01,  1.13s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:03<00:00,  1.03it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:03<00:00,  1.02s/it]
2024-10-03 01:11:45,252 - INFO - Loading model done
2024-10-03 01:11:45,252 - INFO - Replacing layers
2024-10-03 01:11:46,128 - INFO - Replacing layers done
2024-10-03 01:11:46,128 - INFO - Fusing layernorm modules
2024-10-03 01:11:49,065 - INFO - Fusing layernorm modules done
2024-10-03 01:11:49,288 - INFO - Loading sliced model weights from /home/scur1769/ALMA-Matters/models
/gpfs/home4/scur1769/ALMA-Matters/compression/pruning/TransformerCompression/src/slicegpt/hf_utils.py:183: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  torch.load(str(pathlib.Path(sliced_model_path) / my_sliced_model_name), map_location="cpu")
2024-10-03 01:11:54,921 - INFO - Model dtype: torch.float16
  0%|          | 0/255 [00:00<?, ?it/s]  0%|          | 1/255 [00:02<12:16,  2.90s/it]  1%|          | 2/255 [00:05<11:19,  2.69s/it]  1%|          | 3/255 [00:07<10:34,  2.52s/it]  2%|▏         | 4/255 [00:11<12:22,  2.96s/it]  2%|▏         | 5/255 [00:15<13:45,  3.30s/it]  2%|▏         | 6/255 [00:19<15:40,  3.78s/it]  3%|▎         | 7/255 [00:24<15:57,  3.86s/it]  3%|▎         | 8/255 [00:26<13:50,  3.36s/it]  4%|▎         | 9/255 [00:29<13:31,  3.30s/it]  4%|▍         | 10/255 [00:32<12:53,  3.16s/it]  4%|▍         | 11/255 [00:36<14:33,  3.58s/it]  5%|▍         | 12/255 [00:42<16:28,  4.07s/it]  5%|▌         | 13/255 [00:45<15:45,  3.91s/it]  5%|▌         | 14/255 [00:47<13:28,  3.35s/it]  6%|▌         | 15/255 [01:14<41:54, 10.48s/it]  6%|▋         | 16/255 [01:38<58:12, 14.61s/it]  7%|▋         | 17/255 [01:40<42:49, 10.79s/it]  7%|▋         | 18/255 [01:43<32:42,  8.28s/it]  7%|▋         | 19/255 [01:45<26:05,  6.63s/it]  8%|▊         | 20/255 [01:48<21:12,  5.42s/it]  8%|▊         | 21/255 [01:51<17:58,  4.61s/it]  9%|▊         | 22/255 [01:55<17:34,  4.52s/it]  9%|▉         | 23/255 [01:59<16:13,  4.20s/it]  9%|▉         | 24/255 [02:01<14:35,  3.79s/it] 10%|▉         | 25/255 [02:28<40:41, 10.62s/it] 10%|█         | 26/255 [02:30<30:39,  8.03s/it] 11%|█         | 27/255 [02:58<52:46, 13.89s/it] 11%|█         | 28/255 [03:01<40:41, 10.75s/it] 11%|█▏        | 29/255 [03:04<31:35,  8.39s/it] 12%|█▏        | 30/255 [03:35<56:55, 15.18s/it] 12%|█▏        | 31/255 [04:01<1:09:16, 18.56s/it] 13%|█▎        | 32/255 [04:04<51:22, 13.82s/it]   13%|█▎        | 33/255 [04:07<39:24, 10.65s/it] 13%|█▎        | 34/255 [04:12<32:27,  8.81s/it] 14%|█▎        | 35/255 [04:37<50:03, 13.65s/it] 14%|█▍        | 36/255 [05:00<1:00:17, 16.52s/it] 15%|█▍        | 37/255 [05:24<1:08:04, 18.74s/it] 15%|█▍        | 38/255 [05:28<51:31, 14.25s/it]   15%|█▌        | 39/255 [05:31<39:36, 11.00s/it] 16%|█▌        | 40/255 [05:33<29:20,  8.19s/it] 16%|█▌        | 41/255 [05:56<45:38, 12.80s/it] 16%|█▋        | 42/255 [06:00<35:24,  9.98s/it] 17%|█▋        | 43/255 [06:02<27:03,  7.66s/it] 17%|█▋        | 44/255 [06:04<21:21,  6.08s/it] 18%|█▊        | 45/255 [06:06<16:47,  4.80s/it] 18%|█▊        | 46/255 [06:08<13:16,  3.81s/it] 18%|█▊        | 47/255 [06:12<13:39,  3.94s/it] 19%|█▉        | 48/255 [06:14<11:35,  3.36s/it] 19%|█▉        | 49/255 [06:18<11:52,  3.46s/it] 20%|█▉        | 50/255 [06:20<10:21,  3.03s/it] 20%|██        | 51/255 [06:22<09:10,  2.70s/it] 20%|██        | 52/255 [06:23<08:19,  2.46s/it] 21%|██        | 53/255 [06:26<08:17,  2.46s/it] 21%|██        | 54/255 [06:28<07:24,  2.21s/it] 22%|██▏       | 55/255 [06:29<07:00,  2.10s/it] 22%|██▏       | 56/255 [06:53<28:33,  8.61s/it] 22%|██▏       | 57/255 [07:21<47:19, 14.34s/it] 23%|██▎       | 58/255 [07:23<34:40, 10.56s/it] 23%|██▎       | 59/255 [07:25<26:26,  8.10s/it] 24%|██▎       | 60/255 [07:28<21:48,  6.71s/it] 24%|██▍       | 61/255 [07:55<41:21, 12.79s/it] 24%|██▍       | 62/255 [08:20<52:23, 16.29s/it] 25%|██▍       | 63/255 [08:22<38:33, 12.05s/it] 25%|██▌       | 64/255 [08:25<29:35,  9.30s/it] 25%|██▌       | 65/255 [08:28<23:44,  7.50s/it] 26%|██▌       | 66/255 [08:30<18:26,  5.85s/it] 26%|██▋       | 67/255 [08:32<14:45,  4.71s/it] 27%|██▋       | 68/255 [08:35<12:33,  4.03s/it] 27%|██▋       | 69/255 [09:02<33:46, 10.90s/it] 27%|██▋       | 70/255 [09:03<24:53,  8.07s/it] 28%|██▊       | 71/255 [09:06<20:09,  6.57s/it] 28%|██▊       | 72/255 [09:10<17:44,  5.82s/it] 29%|██▊       | 73/255 [09:15<16:33,  5.46s/it] 29%|██▉       | 74/255 [09:16<12:50,  4.26s/it] 29%|██▉       | 75/255 [09:41<31:02, 10.35s/it] 30%|██▉       | 76/255 [09:43<23:06,  7.75s/it] 30%|███       | 77/255 [09:46<18:56,  6.38s/it] 31%|███       | 78/255 [09:47<14:42,  4.99s/it] 31%|███       | 79/255 [09:49<11:26,  3.90s/it] 31%|███▏      | 80/255 [09:50<09:09,  3.14s/it] 32%|███▏      | 81/255 [09:53<08:49,  3.04s/it] 32%|███▏      | 82/255 [09:56<08:30,  2.95s/it] 33%|███▎      | 83/255 [10:00<09:15,  3.23s/it] 33%|███▎      | 84/255 [10:03<09:22,  3.29s/it] 33%|███▎      | 85/255 [10:06<08:40,  3.06s/it] 34%|███▎      | 86/255 [10:09<08:32,  3.03s/it] 34%|███▍      | 87/255 [10:12<08:40,  3.10s/it] 35%|███▍      | 88/255 [10:14<07:56,  2.85s/it] 35%|███▍      | 89/255 [10:17<07:37,  2.75s/it] 35%|███▌      | 90/255 [10:41<25:12,  9.17s/it] 36%|███▌      | 91/255 [11:05<37:14, 13.62s/it] 36%|███▌      | 92/255 [11:08<28:35, 10.53s/it] 36%|███▋      | 93/255 [11:10<21:11,  7.85s/it] 37%|███▋      | 94/255 [11:12<16:31,  6.16s/it] 37%|███▋      | 95/255 [11:13<12:46,  4.79s/it] 38%|███▊      | 96/255 [11:15<10:22,  3.92s/it] 38%|███▊      | 97/255 [11:19<10:01,  3.81s/it] 38%|███▊      | 98/255 [11:22<09:15,  3.54s/it] 39%|███▉      | 99/255 [11:25<08:44,  3.36s/it] 39%|███▉      | 100/255 [11:27<07:53,  3.05s/it] 40%|███▉      | 101/255 [11:29<06:44,  2.63s/it] 40%|████      | 102/255 [11:31<06:32,  2.57s/it] 40%|████      | 103/255 [11:34<07:00,  2.77s/it] 41%|████      | 104/255 [11:36<06:08,  2.44s/it] 41%|████      | 105/255 [12:01<22:55,  9.17s/it] 42%|████▏     | 106/255 [12:05<18:38,  7.50s/it] 42%|████▏     | 107/255 [12:07<14:38,  5.93s/it] 42%|████▏     | 108/255 [12:10<12:14,  5.00s/it] 43%|████▎     | 109/255 [12:13<11:08,  4.58s/it] 43%|████▎     | 110/255 [12:18<11:03,  4.58s/it] 44%|████▎     | 111/255 [12:46<27:59, 11.67s/it] 44%|████▍     | 112/255 [12:49<21:37,  9.08s/it] 44%|████▍     | 113/255 [12:52<16:55,  7.15s/it] 45%|████▍     | 114/255 [12:54<13:05,  5.57s/it] 45%|████▌     | 115/255 [12:55<10:06,  4.33s/it] 45%|████▌     | 116/255 [12:56<08:01,  3.46s/it] 46%|████▌     | 117/255 [12:58<06:50,  2.98s/it] 46%|████▋     | 118/255 [13:25<23:01, 10.08s/it] 47%|████▋     | 119/255 [13:28<17:44,  7.83s/it] 47%|████▋     | 120/255 [13:30<13:52,  6.17s/it] 47%|████▋     | 121/255 [13:32<10:53,  4.87s/it] 48%|████▊     | 122/255 [13:33<08:25,  3.80s/it] 48%|████▊     | 123/255 [13:36<07:55,  3.60s/it] 49%|████▊     | 124/255 [13:38<06:47,  3.11s/it] 49%|████▉     | 125/255 [14:02<20:34,  9.50s/it] 49%|████▉     | 126/255 [14:04<15:24,  7.17s/it] 50%|████▉     | 127/255 [14:07<12:28,  5.85s/it] 50%|█████     | 128/255 [14:31<24:00, 11.34s/it] 51%|█████     | 129/255 [14:59<34:10, 16.27s/it] 51%|█████     | 130/255 [15:01<25:14, 12.11s/it] 51%|█████▏    | 131/255 [15:26<32:38, 15.80s/it] 52%|█████▏    | 132/255 [15:30<25:30, 12.45s/it] 52%|█████▏    | 133/255 [15:34<19:52,  9.78s/it] 53%|█████▎    | 134/255 [15:37<15:25,  7.65s/it] 53%|█████▎    | 135/255 [15:38<11:46,  5.88s/it] 53%|█████▎    | 136/255 [15:40<09:14,  4.66s/it] 54%|█████▎    | 137/255 [15:42<07:18,  3.72s/it] 54%|█████▍    | 138/255 [15:43<05:57,  3.06s/it] 55%|█████▍    | 139/255 [15:45<04:58,  2.57s/it] 55%|█████▍    | 140/255 [15:48<05:17,  2.76s/it] 55%|█████▌    | 141/255 [15:50<05:03,  2.66s/it] 56%|█████▌    | 142/255 [15:53<04:54,  2.61s/it] 56%|█████▌    | 143/255 [15:56<05:23,  2.89s/it] 56%|█████▋    | 144/255 [16:00<05:36,  3.03s/it] 57%|█████▋    | 145/255 [16:01<04:50,  2.64s/it] 57%|█████▋    | 146/255 [16:04<04:38,  2.55s/it] 58%|█████▊    | 147/255 [16:08<05:42,  3.17s/it] 58%|█████▊    | 148/255 [16:11<05:22,  3.02s/it] 58%|█████▊    | 149/255 [16:36<16:48,  9.52s/it] 59%|█████▉    | 150/255 [16:37<12:19,  7.05s/it] 59%|█████▉    | 151/255 [17:02<21:28, 12.39s/it] 60%|█████▉    | 152/255 [17:06<16:51,  9.82s/it] 60%|██████    | 153/255 [17:09<13:24,  7.89s/it] 60%|██████    | 154/255 [17:12<10:52,  6.46s/it] 61%|██████    | 155/255 [17:15<09:08,  5.49s/it] 61%|██████    | 156/255 [17:19<08:06,  4.92s/it] 62%|██████▏   | 157/255 [17:47<19:34, 11.98s/it] 62%|██████▏   | 158/255 [17:50<14:54,  9.22s/it] 62%|██████▏   | 159/255 [17:53<11:40,  7.30s/it] 63%|██████▎   | 160/255 [17:55<08:55,  5.63s/it] 63%|██████▎   | 161/255 [17:58<07:34,  4.83s/it] 64%|██████▎   | 162/255 [18:01<06:34,  4.24s/it] 64%|██████▍   | 163/255 [18:02<05:23,  3.52s/it] 64%|██████▍   | 164/255 [18:05<04:45,  3.13s/it] 65%|██████▍   | 165/255 [18:07<04:15,  2.84s/it] 65%|██████▌   | 166/255 [18:09<04:06,  2.77s/it] 65%|██████▌   | 167/255 [18:12<03:52,  2.64s/it] 66%|██████▌   | 168/255 [18:15<03:59,  2.75s/it] 66%|██████▋   | 169/255 [18:18<04:02,  2.82s/it] 67%|██████▋   | 170/255 [18:20<03:41,  2.61s/it] 67%|██████▋   | 171/255 [18:24<04:24,  3.15s/it] 67%|██████▋   | 172/255 [18:28<04:26,  3.21s/it] 68%|██████▊   | 173/255 [18:32<04:41,  3.43s/it] 68%|██████▊   | 174/255 [18:39<06:10,  4.58s/it] 69%|██████▊   | 175/255 [18:44<06:09,  4.62s/it] 69%|██████▉   | 176/255 [19:10<14:38, 11.12s/it] 69%|██████▉   | 177/255 [19:11<10:39,  8.20s/it] 70%|██████▉   | 178/255 [19:13<08:09,  6.36s/it] 70%|███████   | 179/255 [19:16<06:42,  5.30s/it] 71%|███████   | 180/255 [19:20<06:07,  4.89s/it] 71%|███████   | 181/255 [19:23<05:20,  4.32s/it] 71%|███████▏  | 182/255 [19:26<04:40,  3.84s/it] 72%|███████▏  | 183/255 [19:28<04:01,  3.35s/it] 72%|███████▏  | 184/255 [19:30<03:33,  3.01s/it] 73%|███████▎  | 185/255 [19:33<03:24,  2.92s/it] 73%|███████▎  | 186/255 [19:36<03:21,  2.91s/it] 73%|███████▎  | 187/255 [19:38<03:05,  2.72s/it] 74%|███████▎  | 188/255 [19:41<03:01,  2.71s/it] 74%|███████▍  | 189/255 [20:05<10:11,  9.26s/it] 75%|███████▍  | 190/255 [20:08<07:57,  7.35s/it] 75%|███████▍  | 191/255 [20:13<06:54,  6.48s/it] 75%|███████▌  | 192/255 [20:15<05:34,  5.30s/it] 76%|███████▌  | 193/255 [20:18<04:48,  4.65s/it] 76%|███████▌  | 194/255 [20:20<03:45,  3.70s/it] 76%|███████▋  | 195/255 [20:22<03:11,  3.19s/it] 77%|███████▋  | 196/255 [20:24<02:51,  2.91s/it] 77%|███████▋  | 197/255 [20:26<02:36,  2.69s/it] 78%|███████▊  | 198/255 [20:28<02:12,  2.32s/it] 78%|███████▊  | 199/255 [20:29<01:53,  2.02s/it] 78%|███████▊  | 200/255 [20:32<02:04,  2.27s/it] 79%|███████▉  | 201/255 [20:35<02:20,  2.60s/it] 79%|███████▉  | 202/255 [20:39<02:34,  2.92s/it] 80%|███████▉  | 203/255 [21:03<07:57,  9.19s/it] 80%|████████  | 204/255 [21:29<12:04, 14.20s/it] 80%|████████  | 205/255 [21:52<14:15, 17.10s/it] 81%|████████  | 206/255 [22:19<16:13, 19.87s/it] 81%|████████  | 207/255 [22:24<12:21, 15.44s/it] 82%|████████▏ | 208/255 [22:26<09:03, 11.56s/it] 82%|████████▏ | 209/255 [22:29<06:52,  8.97s/it] 82%|████████▏ | 210/255 [22:33<05:34,  7.43s/it] 83%|████████▎ | 211/255 [22:36<04:25,  6.04s/it] 83%|████████▎ | 212/255 [22:37<03:21,  4.68s/it] 84%|████████▎ | 213/255 [22:39<02:38,  3.77s/it] 84%|████████▍ | 214/255 [22:42<02:19,  3.41s/it] 84%|████████▍ | 215/255 [23:09<07:04, 10.61s/it] 85%|████████▍ | 216/255 [23:11<05:17,  8.13s/it] 85%|████████▌ | 217/255 [23:16<04:24,  6.95s/it] 85%|████████▌ | 218/255 [23:21<03:58,  6.45s/it] 86%|████████▌ | 219/255 [23:23<03:09,  5.25s/it] 86%|████████▋ | 220/255 [23:26<02:39,  4.57s/it] 87%|████████▋ | 221/255 [23:35<03:20,  5.89s/it] 87%|████████▋ | 222/255 [23:39<02:49,  5.15s/it] 87%|████████▋ | 223/255 [23:42<02:26,  4.58s/it] 88%|████████▊ | 224/255 [23:44<02:02,  3.94s/it] 88%|████████▊ | 225/255 [23:47<01:43,  3.46s/it] 89%|████████▊ | 226/255 [23:49<01:28,  3.05s/it] 89%|████████▉ | 227/255 [23:54<01:39,  3.56s/it] 89%|████████▉ | 228/255 [23:56<01:28,  3.29s/it] 90%|████████▉ | 229/255 [23:59<01:19,  3.05s/it] 90%|█████████ | 230/255 [24:22<03:50,  9.22s/it] 91%|█████████ | 231/255 [24:26<02:59,  7.47s/it] 91%|█████████ | 232/255 [24:28<02:18,  6.03s/it] 91%|█████████▏| 233/255 [24:32<01:57,  5.35s/it] 92%|█████████▏| 234/255 [25:02<04:28, 12.80s/it] 92%|█████████▏| 235/255 [25:06<03:22, 10.12s/it] 93%|█████████▎| 236/255 [25:10<02:35,  8.18s/it] 93%|█████████▎| 237/255 [25:13<01:59,  6.66s/it] 93%|█████████▎| 238/255 [25:17<01:37,  5.73s/it] 94%|█████████▎| 239/255 [25:20<01:22,  5.17s/it] 94%|█████████▍| 240/255 [25:24<01:11,  4.77s/it] 95%|█████████▍| 241/255 [25:28<01:00,  4.33s/it] 95%|█████████▍| 242/255 [25:35<01:08,  5.29s/it] 95%|█████████▌| 243/255 [25:37<00:51,  4.27s/it] 96%|█████████▌| 244/255 [25:39<00:39,  3.59s/it] 96%|█████████▌| 245/255 [25:42<00:32,  3.25s/it] 96%|█████████▋| 246/255 [25:44<00:26,  2.96s/it] 97%|█████████▋| 247/255 [25:46<00:21,  2.73s/it] 97%|█████████▋| 248/255 [25:48<00:17,  2.47s/it] 98%|█████████▊| 249/255 [25:55<00:22,  3.83s/it] 98%|█████████▊| 250/255 [25:59<00:19,  3.98s/it] 98%|█████████▊| 251/255 [26:03<00:16,  4.00s/it] 99%|█████████▉| 252/255 [26:06<00:11,  3.73s/it] 99%|█████████▉| 253/255 [26:09<00:06,  3.43s/it]100%|█████████▉| 254/255 [26:13<00:03,  3.54s/it]100%|██████████| 255/255 [26:14<00:00,  2.69s/it]100%|██████████| 255/255 [26:14<00:00,  6.17s/it]
2024-10-03 01:38:08,994 - INFO - Completed evaluation for en-zh. Results saved to /home/scur1769/ALMA-Matters/evaluation/results/30-slice/result_en-zh.txt
Processing file: /home/scur1769/ALMA-Matters/datasets/human-translations/ALMA_test_is-en.json
2024-10-03 01:38:12,875 - INFO - Loading sliced haoranxu/ALMA-7B model from /home/scur1769/ALMA-Matters/models with sparsity 0.3
2024-10-03 01:38:12,875 - INFO - Loading haoranxu/ALMA-7B config from Hugging Face
Using LlamaAdapter for ALMA-7B
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:01<00:02,  1.18s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:02<00:01,  1.16s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:03<00:00,  1.00it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:03<00:00,  1.04s/it]
2024-10-03 01:38:17,331 - INFO - Loading model done
2024-10-03 01:38:17,331 - INFO - Replacing layers
2024-10-03 01:38:18,202 - INFO - Replacing layers done
2024-10-03 01:38:18,202 - INFO - Fusing layernorm modules
2024-10-03 01:38:21,127 - INFO - Fusing layernorm modules done
2024-10-03 01:38:21,354 - INFO - Loading sliced model weights from /home/scur1769/ALMA-Matters/models
/gpfs/home4/scur1769/ALMA-Matters/compression/pruning/TransformerCompression/src/slicegpt/hf_utils.py:183: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  torch.load(str(pathlib.Path(sliced_model_path) / my_sliced_model_name), map_location="cpu")
2024-10-03 01:38:27,009 - INFO - Model dtype: torch.float16
  0%|          | 0/125 [00:00<?, ?it/s]  1%|          | 1/125 [00:31<1:05:16, 31.59s/it]  2%|▏         | 2/125 [00:34<29:52, 14.57s/it]    2%|▏         | 3/125 [00:38<20:24, 10.03s/it]  3%|▎         | 4/125 [01:14<40:20, 20.00s/it]  4%|▍         | 5/125 [01:19<29:23, 14.70s/it]  5%|▍         | 6/125 [01:23<21:54, 11.05s/it]  6%|▌         | 7/125 [01:52<33:10, 16.87s/it]  6%|▋         | 8/125 [02:25<43:11, 22.15s/it]  7%|▋         | 9/125 [02:30<32:33, 16.84s/it]  8%|▊         | 10/125 [02:59<39:12, 20.45s/it]  9%|▉         | 11/125 [03:04<30:01, 15.80s/it] 10%|▉         | 12/125 [03:08<22:40, 12.04s/it] 10%|█         | 13/125 [03:10<17:09,  9.19s/it] 11%|█         | 14/125 [03:12<13:04,  7.07s/it] 12%|█▏        | 15/125 [03:16<11:04,  6.04s/it] 13%|█▎        | 16/125 [03:19<09:23,  5.17s/it] 14%|█▎        | 17/125 [03:50<23:01, 12.79s/it] 14%|█▍        | 18/125 [03:58<20:29, 11.49s/it] 15%|█▌        | 19/125 [04:29<30:39, 17.36s/it] 16%|█▌        | 20/125 [04:33<23:16, 13.30s/it] 17%|█▋        | 21/125 [04:38<18:39, 10.77s/it] 18%|█▊        | 22/125 [04:42<14:56,  8.71s/it] 18%|█▊        | 23/125 [04:44<11:40,  6.87s/it] 19%|█▉        | 24/125 [05:15<23:29, 13.96s/it] 20%|██        | 25/125 [05:45<31:29, 18.90s/it] 21%|██        | 26/125 [06:14<35:58, 21.80s/it] 22%|██▏       | 27/125 [06:46<40:39, 24.89s/it] 22%|██▏       | 28/125 [06:50<30:06, 18.62s/it] 23%|██▎       | 29/125 [07:18<34:31, 21.57s/it] 24%|██▍       | 30/125 [07:22<25:34, 16.16s/it] 25%|██▍       | 31/125 [07:53<32:15, 20.59s/it] 26%|██▌       | 32/125 [08:21<35:15, 22.75s/it] 26%|██▋       | 33/125 [08:23<25:26, 16.60s/it] 27%|██▋       | 34/125 [08:26<19:01, 12.55s/it] 28%|██▊       | 35/125 [08:29<14:21,  9.57s/it] 29%|██▉       | 36/125 [08:56<22:09, 14.94s/it] 30%|██▉       | 37/125 [09:27<29:03, 19.82s/it] 30%|███       | 38/125 [09:58<33:28, 23.09s/it] 31%|███       | 39/125 [10:01<24:18, 16.96s/it] 32%|███▏      | 40/125 [10:32<30:03, 21.21s/it] 33%|███▎      | 41/125 [11:03<33:46, 24.12s/it] 34%|███▎      | 42/125 [11:05<24:21, 17.61s/it] 34%|███▍      | 43/125 [11:38<30:27, 22.29s/it] 35%|███▌      | 44/125 [11:42<22:38, 16.77s/it] 36%|███▌      | 45/125 [11:46<16:58, 12.73s/it] 37%|███▋      | 46/125 [11:55<15:16, 11.60s/it] 38%|███▊      | 47/125 [12:25<22:26, 17.26s/it] 38%|███▊      | 48/125 [12:56<27:26, 21.38s/it] 39%|███▉      | 49/125 [13:00<20:18, 16.03s/it] 40%|████      | 50/125 [13:31<25:56, 20.75s/it] 41%|████      | 51/125 [13:54<26:07, 21.18s/it] 42%|████▏     | 52/125 [13:59<19:59, 16.44s/it] 42%|████▏     | 53/125 [14:04<15:46, 13.14s/it] 43%|████▎     | 54/125 [14:35<21:45, 18.39s/it] 44%|████▍     | 55/125 [14:39<16:29, 14.14s/it] 45%|████▍     | 56/125 [15:08<21:23, 18.61s/it] 46%|████▌     | 57/125 [15:42<26:07, 23.05s/it] 46%|████▋     | 58/125 [15:44<18:48, 16.84s/it] 47%|████▋     | 59/125 [15:47<13:55, 12.66s/it] 48%|████▊     | 60/125 [16:17<19:13, 17.75s/it] 49%|████▉     | 61/125 [16:19<14:04, 13.20s/it] 50%|████▉     | 62/125 [16:53<20:15, 19.29s/it] 50%|█████     | 63/125 [17:22<23:00, 22.26s/it] 51%|█████     | 64/125 [17:26<17:04, 16.80s/it] 52%|█████▏    | 65/125 [18:00<21:53, 21.89s/it] 53%|█████▎    | 66/125 [18:19<20:51, 21.20s/it] 54%|█████▎    | 67/125 [18:55<24:46, 25.63s/it] 54%|█████▍    | 68/125 [19:07<20:30, 21.58s/it] 55%|█████▌    | 69/125 [19:11<15:12, 16.30s/it] 56%|█████▌    | 70/125 [19:13<11:03, 12.06s/it] 57%|█████▋    | 71/125 [19:19<08:59,  9.99s/it] 58%|█████▊    | 72/125 [19:23<07:25,  8.41s/it] 58%|█████▊    | 73/125 [19:29<06:30,  7.52s/it] 59%|█████▉    | 74/125 [20:03<13:10, 15.50s/it] 60%|██████    | 75/125 [20:36<17:13, 20.67s/it] 61%|██████    | 76/125 [20:39<12:39, 15.51s/it] 62%|██████▏   | 77/125 [20:43<09:35, 11.99s/it] 62%|██████▏   | 78/125 [20:46<07:20,  9.38s/it] 63%|██████▎   | 79/125 [21:14<11:21, 14.82s/it] 64%|██████▍   | 80/125 [21:44<14:41, 19.58s/it] 65%|██████▍   | 81/125 [22:13<16:20, 22.29s/it] 66%|██████▌   | 82/125 [22:45<17:57, 25.06s/it] 66%|██████▋   | 83/125 [22:47<12:53, 18.42s/it] 67%|██████▋   | 84/125 [22:50<09:21, 13.70s/it] 68%|██████▊   | 85/125 [22:53<06:57, 10.44s/it] 69%|██████▉   | 86/125 [23:22<10:21, 15.93s/it] 70%|██████▉   | 87/125 [23:26<07:53, 12.45s/it] 70%|███████   | 88/125 [23:28<05:47,  9.39s/it] 71%|███████   | 89/125 [23:31<04:30,  7.51s/it] 72%|███████▏  | 90/125 [23:36<03:47,  6.50s/it] 73%|███████▎  | 91/125 [23:38<02:58,  5.26s/it] 74%|███████▎  | 92/125 [24:07<06:47, 12.34s/it] 74%|███████▍  | 93/125 [24:39<09:43, 18.22s/it] 75%|███████▌  | 94/125 [25:13<11:54, 23.05s/it] 76%|███████▌  | 95/125 [25:17<08:41, 17.38s/it] 77%|███████▋  | 96/125 [25:46<10:02, 20.77s/it] 78%|███████▊  | 97/125 [26:19<11:21, 24.35s/it] 78%|███████▊  | 98/125 [26:49<11:48, 26.25s/it] 79%|███████▉  | 99/125 [26:52<08:19, 19.19s/it] 80%|████████  | 100/125 [26:55<05:55, 14.24s/it] 81%|████████  | 101/125 [27:25<07:37, 19.05s/it] 82%|████████▏ | 102/125 [27:58<08:54, 23.26s/it] 82%|████████▏ | 103/125 [28:32<09:45, 26.61s/it] 83%|████████▎ | 104/125 [29:00<09:24, 26.88s/it] 84%|████████▍ | 105/125 [29:31<09:24, 28.22s/it] 85%|████████▍ | 106/125 [29:34<06:33, 20.68s/it] 86%|████████▌ | 107/125 [30:06<07:09, 23.86s/it] 86%|████████▋ | 108/125 [30:39<07:33, 26.69s/it] 87%|████████▋ | 109/125 [31:10<07:29, 28.07s/it] 88%|████████▊ | 110/125 [31:14<05:12, 20.86s/it] 89%|████████▉ | 111/125 [31:18<03:41, 15.80s/it] 90%|████████▉ | 112/125 [31:24<02:46, 12.82s/it] 90%|█████████ | 113/125 [31:59<03:54, 19.55s/it] 91%|█████████ | 114/125 [32:05<02:47, 15.25s/it] 92%|█████████▏| 115/125 [32:38<03:27, 20.75s/it] 93%|█████████▎| 116/125 [33:10<03:36, 24.07s/it] 94%|█████████▎| 117/125 [33:42<03:32, 26.54s/it] 94%|█████████▍| 118/125 [34:14<03:16, 28.03s/it] 95%|█████████▌| 119/125 [34:44<02:51, 28.61s/it] 96%|█████████▌| 120/125 [35:23<02:39, 31.86s/it] 97%|█████████▋| 121/125 [35:27<01:33, 23.41s/it] 98%|█████████▊| 122/125 [36:00<01:18, 26.28s/it] 98%|█████████▊| 123/125 [36:31<00:55, 27.78s/it] 99%|█████████▉| 124/125 [37:02<00:28, 28.83s/it]100%|██████████| 125/125 [37:35<00:00, 29.96s/it]126it [38:09, 31.13s/it]                         127it [38:38, 30.64s/it]128it [39:10, 31.02s/it]129it [39:12, 22.22s/it]129it [39:12, 18.24s/it]
2024-10-03 02:17:39,551 - INFO - Completed evaluation for is-en. Results saved to /home/scur1769/ALMA-Matters/evaluation/results/30-slice/result_is-en.txt
Processing file: /home/scur1769/ALMA-Matters/datasets/human-translations/ALMA_test_ru-en.json
2024-10-03 02:17:43,462 - INFO - Loading sliced haoranxu/ALMA-7B model from /home/scur1769/ALMA-Matters/models with sparsity 0.3
2024-10-03 02:17:43,462 - INFO - Loading haoranxu/ALMA-7B config from Hugging Face
Using LlamaAdapter for ALMA-7B
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:01<00:02,  1.16s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:02<00:01,  1.14s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:03<00:00,  1.02it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:03<00:00,  1.03s/it]
2024-10-03 02:17:47,839 - INFO - Loading model done
2024-10-03 02:17:47,840 - INFO - Replacing layers
2024-10-03 02:17:48,714 - INFO - Replacing layers done
2024-10-03 02:17:48,714 - INFO - Fusing layernorm modules
2024-10-03 02:17:51,660 - INFO - Fusing layernorm modules done
2024-10-03 02:17:51,884 - INFO - Loading sliced model weights from /home/scur1769/ALMA-Matters/models
/gpfs/home4/scur1769/ALMA-Matters/compression/pruning/TransformerCompression/src/slicegpt/hf_utils.py:183: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  torch.load(str(pathlib.Path(sliced_model_path) / my_sliced_model_name), map_location="cpu")
2024-10-03 02:17:57,505 - INFO - Model dtype: torch.float16
  0%|          | 0/252 [00:00<?, ?it/s]  0%|          | 1/252 [00:02<11:53,  2.84s/it]  1%|          | 2/252 [00:05<10:45,  2.58s/it]  1%|          | 3/252 [00:34<1:02:04, 14.96s/it]  2%|▏         | 4/252 [00:37<41:23, 10.01s/it]    2%|▏         | 5/252 [01:02<1:03:49, 15.50s/it]  2%|▏         | 6/252 [01:04<45:06, 11.00s/it]    3%|▎         | 7/252 [01:31<1:05:29, 16.04s/it]  3%|▎         | 8/252 [01:34<48:18, 11.88s/it]    4%|▎         | 9/252 [02:01<1:07:16, 16.61s/it]  4%|▍         | 10/252 [02:04<50:02, 12.41s/it]   4%|▍         | 11/252 [02:32<1:09:12, 17.23s/it]  5%|▍         | 12/252 [02:56<1:17:16, 19.32s/it]  5%|▌         | 13/252 [03:26<1:29:18, 22.42s/it]  6%|▌         | 14/252 [03:30<1:07:10, 16.94s/it]  6%|▌         | 15/252 [03:34<51:06, 12.94s/it]    6%|▋         | 16/252 [03:37<39:53, 10.14s/it]  7%|▋         | 17/252 [04:09<1:05:29, 16.72s/it]  7%|▋         | 18/252 [04:38<1:19:13, 20.32s/it]  8%|▊         | 19/252 [05:09<1:31:12, 23.49s/it]  8%|▊         | 20/252 [05:15<1:10:18, 18.18s/it]  8%|▊         | 21/252 [05:49<1:28:42, 23.04s/it]  9%|▊         | 22/252 [06:18<1:35:23, 24.88s/it]  9%|▉         | 23/252 [06:21<1:10:02, 18.35s/it] 10%|▉         | 24/252 [06:51<1:23:15, 21.91s/it] 10%|▉         | 25/252 [06:54<1:01:20, 16.22s/it] 10%|█         | 26/252 [06:58<46:26, 12.33s/it]   11%|█         | 27/252 [07:28<1:06:02, 17.61s/it] 11%|█         | 28/252 [07:30<49:03, 13.14s/it]   12%|█▏        | 29/252 [07:34<38:22, 10.33s/it] 12%|█▏        | 30/252 [07:38<30:40,  8.29s/it] 12%|█▏        | 31/252 [08:09<55:55, 15.18s/it] 13%|█▎        | 32/252 [08:13<43:18, 11.81s/it] 13%|█▎        | 33/252 [08:17<34:46,  9.53s/it] 13%|█▎        | 34/252 [08:42<51:12, 14.09s/it] 14%|█▍        | 35/252 [09:13<1:09:05, 19.10s/it] 14%|█▍        | 36/252 [09:41<1:18:28, 21.80s/it] 15%|█▍        | 37/252 [10:11<1:26:59, 24.28s/it] 15%|█▌        | 38/252 [10:13<1:03:21, 17.76s/it] 15%|█▌        | 39/252 [10:39<1:11:28, 20.13s/it] 16%|█▌        | 40/252 [10:40<51:28, 14.57s/it]   16%|█▋        | 41/252 [10:45<40:24, 11.49s/it] 17%|█▋        | 42/252 [10:47<30:27,  8.70s/it] 17%|█▋        | 43/252 [11:13<48:48, 14.01s/it] 17%|█▋        | 44/252 [11:21<41:56, 12.10s/it] 18%|█▊        | 45/252 [11:25<33:17,  9.65s/it] 18%|█▊        | 46/252 [11:29<27:05,  7.89s/it] 19%|█▊        | 47/252 [12:00<50:37, 14.82s/it] 19%|█▉        | 48/252 [12:07<42:11, 12.41s/it] 19%|█▉        | 49/252 [12:08<30:59,  9.16s/it] 20%|█▉        | 50/252 [12:10<23:24,  6.95s/it] 20%|██        | 51/252 [12:13<19:34,  5.84s/it] 21%|██        | 52/252 [12:18<18:02,  5.41s/it] 21%|██        | 53/252 [12:23<18:06,  5.46s/it] 21%|██▏       | 54/252 [12:53<42:31, 12.89s/it] 22%|██▏       | 55/252 [12:57<33:01, 10.06s/it] 22%|██▏       | 56/252 [13:26<52:04, 15.94s/it] 23%|██▎       | 57/252 [13:29<39:03, 12.02s/it] 23%|██▎       | 58/252 [13:31<29:02,  8.98s/it] 23%|██▎       | 59/252 [13:34<22:31,  7.00s/it] 24%|██▍       | 60/252 [14:02<43:00, 13.44s/it] 24%|██▍       | 61/252 [14:32<58:45, 18.46s/it] 25%|██▍       | 62/252 [14:35<43:05, 13.61s/it] 25%|██▌       | 63/252 [15:01<55:07, 17.50s/it] 25%|██▌       | 64/252 [15:03<40:19, 12.87s/it] 26%|██▌       | 65/252 [15:27<50:25, 16.18s/it] 26%|██▌       | 66/252 [15:30<37:33, 12.12s/it] 27%|██▋       | 67/252 [15:54<48:25, 15.70s/it] 27%|██▋       | 68/252 [16:22<59:19, 19.34s/it] 27%|██▋       | 69/252 [16:55<1:11:37, 23.48s/it] 28%|██▊       | 70/252 [16:58<52:56, 17.45s/it]   28%|██▊       | 71/252 [17:02<39:56, 13.24s/it] 29%|██▊       | 72/252 [17:05<31:18, 10.44s/it] 29%|██▉       | 73/252 [17:37<50:06, 16.80s/it] 29%|██▉       | 74/252 [17:42<38:58, 13.14s/it] 30%|██▉       | 75/252 [17:46<30:37, 10.38s/it] 30%|███       | 76/252 [18:12<44:50, 15.29s/it] 31%|███       | 77/252 [18:17<35:12, 12.07s/it] 31%|███       | 78/252 [18:48<51:07, 17.63s/it] 31%|███▏      | 79/252 [18:55<41:45, 14.48s/it] 32%|███▏      | 80/252 [18:58<31:40, 11.05s/it] 32%|███▏      | 81/252 [19:00<24:02,  8.43s/it] 33%|███▎      | 82/252 [19:30<42:22, 14.95s/it] 33%|███▎      | 83/252 [19:34<32:18, 11.47s/it] 33%|███▎      | 84/252 [20:04<48:02, 17.16s/it] 34%|███▎      | 85/252 [20:06<34:55, 12.55s/it] 34%|███▍      | 86/252 [20:08<25:52,  9.35s/it] 35%|███▍      | 87/252 [20:09<19:27,  7.08s/it] 35%|███▍      | 88/252 [20:39<38:05, 13.94s/it] 35%|███▌      | 89/252 [20:44<29:59, 11.04s/it] 36%|███▌      | 90/252 [21:14<45:45, 16.95s/it]slurmstepd: error: *** JOB 8057898 ON gcn23 CANCELLED AT 2024-10-03T02:39:26 DUE TO TIME LIMIT ***
